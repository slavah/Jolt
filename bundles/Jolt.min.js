/*/////////////////////////////// JOLT /////////////////////////////////
 *
 * Reactive Objects for JavaScript
 * https://github.com/projexsys/Jolt
 *
 * This software is Copyright (c) 2011 by Projexsys, Inc.
 *
 * This is free software, licensed under:
 *
 * The GNU General Public License Version 3
 *
 * The JavaScript code developed and owned by Projexsys, Inc. in this
 * page is free software: you can redistribute it and/or modify it under
 * the terms of the GNU General Public License (GNU GPL) as published by
 * the Free Software Foundation, either version 3 of the License, or (at
 * your option) any later version. The code is distributed WITHOUT ANY
 * WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE. See the GNU GPL for more details.
 *
 * https://raw.github.com/projexsys/Jolt/master/LICENSE
 * http://www.gnu.org/licenses/gpl-3.0.txt
 *
 * However, if you have executed an End User Software License and
 * Services Agreement or an OEM Software License and Support Services
 * Agreement, or another commercial license agreement with Projexsys,
 * Inc. (each, a "Commercial Agreement"), the terms of the license in
 * such Commercial Agreement will supersede the GNU GENERAL PUBLIC
 * LICENSE Version 3 and you may use the Software solely pursuant to the
 * terms of the relevant Commercial Agreement.
 *
//////////////////////////////// CREDIT ////////////////////////////////
 *
 * This program is derived from and incorporates existing works:
 *
 *  https://github.com/brownplt/flapjax
 *  https://github.com/hij1nx/EventEmitter2
 *  https://github.com/jquery/sizzle
 *  https://github.com/documentcloud/underscore
 *  https://github.com/epeli/underscore.string
 *  https://github.com/autotelicum/Smooth-CoffeeScript
 *
 * For further information and license texts please refer to:
 * https://raw.github.com/projexsys/Jolt/master/LICENSES
 *
/*//////////////////////////////////////////////////////////////////////


;(function (exports, undefined) {
  var EventEmitter;(function(a){function d(){this._events=new Object}function e(a){a&&(this.wildcard=a.wildcard,this.delimiter=a.delimiter||".",this.wildcard&&(this.listenerTree=new Object))}function f(a,b,c,d){if(!c)return;var e,g,h,i,j,k,l,m,n=b.length,o=b[d],p=b[d+1];if(d===n&&c._listeners){if(typeof c._listeners=="function")return a&&a.push(c._listeners),c;for(g=0,h=c._listeners.length;g<h;g++)a&&a.push(c._listeners[g]);return c}if(o==="*"||o==="**"||c[o]){if(o==="*"){for(i in c)i!=="_listeners"&&c.hasOwnProperty(i)&&(e=f(a,b,c[i],d+1));return e}if(o==="**"){m=d+1===n||d+2===n&&p==="*",m&&c._listeners&&(e=f(a,b,c,n));for(i in c)i!=="_listeners"&&c.hasOwnProperty(i)&&(i==="*"||i==="**"?(c[i]._listeners&&!m&&(e=f(a,b,c[i],n)),e=f(a,b,c[i],d)):i===p?e=f(a,b,c[i],d+2):e=f(a,b,c[i],d));return e}e=f(a,b,c[o],d+1)}j=c["*"],j&&f(a,b,j,d+1),k=c["**"];if(k)if(d<n){k._listeners&&f(a,b,k,n);for(i in k)i!=="_listeners"&&k.hasOwnProperty(i)&&(i===p?f(a,b,k[i],d+2):i===o?f(a,b,k[i],d+1):(l={},l[i]=k[i],f(a,b,{"**":l},d+1)))}else k._listeners?f(a,b,k,n):k["*"]&&k["*"]._listeners&&f(a,b,k["*"],n);return e}function g(a,d){a=typeof a=="string"?a.split(this.delimiter):a.slice();for(var e=0,f=a.length;e+1<f;e++)if(a[e]==="**"&&a[e+1]==="**")return;var g=this.listenerTree,h=a.shift();while(h){g[h]||(g[h]=new Object),g=g[h];if(a.length===0){if(!g._listeners)g._listeners=d;else if(typeof g._listeners=="function")g._listeners=[g._listeners,d];else if(b(g._listeners)){g._listeners.push(d);if(!g._listeners.warned){var i=c;i>0&&g._listeners.length>i&&(g._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",g._listeners.length),console.trace())}}return!0}h=a.shift()}return!0}var b=Array.isArray?Array.isArray:function(a){return Object.prototype.toString.call(a)==="[object Array]"},c=10;EventEmitter=function(a){this._events=new Object,e.call(this,a)},EventEmitter.prototype.setMaxListeners=function(a){this._events||d.call(this),this._events.maxListeners=a},EventEmitter.prototype.event="",EventEmitter.prototype.once=function(a,b){return this.many(a,1,b),this},EventEmitter.prototype.many=function(a,b,c){function e(){--b===0&&d.off(a,e),c.apply(this,arguments)}var d=this;if(typeof c!="function")throw new Error("many only accepts instances of Function");return e._origin=c,this.on(a,e),d},EventEmitter.prototype.emit=function(){this._events||d.call(this);var a=arguments[0];if(a==="newListener"&&!this._events.newListener)return!1;if(this._all){var b=arguments.length,c=new Array(b-1);for(var e=1;e<b;e++)c[e-1]=arguments[e];for(e=0,b=this._all.length;e<b;e++)this.event=a,this._all[e].apply(this,c)}if(a==="error"&&!this._all&&!this._events.error&&(!this.wildcard||!this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var g;if(this.wildcard){g=[];var h=typeof a=="string"?a.split(this.delimiter):a.slice();f.call(this,g,h,this.listenerTree,0)}else g=this._events[a];if(typeof g=="function"){this.event=a;if(arguments.length===1)g.call(this);else if(arguments.length>1)switch(arguments.length){case 2:g.call(this,arguments[1]);break;case 3:g.call(this,arguments[1],arguments[2]);break;default:var b=arguments.length,c=new Array(b-1);for(var e=1;e<b;e++)c[e-1]=arguments[e];g.apply(this,c)}return!0}if(g){var b=arguments.length,c=new Array(b-1);for(var e=1;e<b;e++)c[e-1]=arguments[e];var i=g.slice();for(var e=0,b=i.length;e<b;e++)this.event=a,i[e].apply(this,c);return!0}},EventEmitter.prototype.on=function(e,f){this._events||d.call(this),this.emit("newListener",e,f);if(this.wildcard)return g.call(this,e,f),this;if(!this._events[e])this._events[e]=f;else if(typeof this._events[e]=="function")this._events[e]=[this._events[e],f];else if(b(this._events[e])){this._events[e].push(f);if(!this._events[e].warned){var h;this._events.maxListeners!==a?h=this._events.maxListeners:h=c,h&&h>0&&this._events[e].length>h&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace())}}return this},EventEmitter.prototype.onAny=function(a){this._all||(this._all=[]);if(typeof a!="function")throw new Error("onAny only accepts instances of Function");return this._all.push(a),this},EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prototype.off=function(a,c){if(typeof c!="function")throw new Error("removeListener only takes instances of Function");var d;if(this.wildcard){var e=typeof a=="string"?a.split(this.delimiter):a.slice(),g=f.call(this,null,e,this.listenerTree,0);if("undefined"==typeof g)return this;d=g._listeners}else{if(!this._events[a])return this;d=this._events[a]}if(b(d)){var h=-1;for(var i=0,j=d.length;i<j;i++)if(d[i]===c||d[i].listener&&d[i].listener===c||d[i]._origin&&d[i]._origin===c){h=i;break}if(h<0)return this;this.wildcard?g._listeners.splice(h,1):this._events[a].splice(h,1),d.length===0&&(this.wildcard?delete g._listeners:delete this._events[a])}else if(d===c||d.listener&&d.listener===c||d._origin&&d._origin===c)this.wildcard?delete g._listeners:delete this._events[a];return this},EventEmitter.prototype.offAny=function(a){var b=0,c=0,d;if(a&&this._all&&this._all.length>0){d=this._all;for(b=0,c=d.length;b<c;b++)if(a===d[b])return d.splice(b,1),this}else this._all=[];return this},EventEmitter.prototype.removeListener=EventEmitter.prototype.off,EventEmitter.prototype.removeAllListeners=function(a){if(arguments.length===0)return!this._events||d.call(this),this;if(this.wildcard){var b=typeof a=="string"?a.split(this.delimiter):a.slice(),c=f.call(this,null,b,this.listenerTree,0);if("undefined"==typeof c)return this;c._listeners=null}else{if(!this._events[a])return this;this._events[a]=null}return this},EventEmitter.prototype.listeners=function(a){if(this.wildcard){var c=[],e=typeof a=="string"?a.split(this.delimiter):a.slice();return f.call(this,c,e,this.listenerTree,0),c}return this._events||d.call(this),this._events[a]||(this._events[a]=[]),b(this._events[a])||(this._events[a]=[this._events[a]]),this._events[a]},EventEmitter.prototype.listenersAny=function(){return this._all?this._all:[]}})();if(typeof document!="undefined"&&document!==null){var Sizzle;(function(){function s(a,c,d,e,f,g){for(var h=0,i=e.length;h<i;h++){var j=e[h];if(j){var k=!1;j=j[a];while(j){if(j[b]===d){k=e[j.sizset];break}j.nodeType===1&&!g&&(j[b]=d,j.sizset=h);if(j.nodeName.toLowerCase()===c){k=j;break}j=j[a]}e[h]=k}}}function t(a,c,d,e,f,g){for(var h=0,i=e.length;h<i;h++){var j=e[h];if(j){var k=!1;j=j[a];while(j){if(j[b]===d){k=e[j.sizset];break}if(j.nodeType===1){g||(j[b]=d,j.sizset=h);if(typeof c!="string"){if(j===c){k=!0;break}}else if(Sizzle.filter(c,[j]).length>0){k=j;break}}j=j[a]}e[h]=k}}}var a=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,b="sizcache"+(Math.random()+"").replace(".",""),c=0,d=Object.prototype.toString,e=!1,f=!0,g=/\\/g,h=/\r\n/g,i=/\W/;[0,0].sort(function(){return f=!1,0}),Sizzle=function(b,c,e,f){e=e||[],c=c||document;var g=c;if(c.nodeType!==1&&c.nodeType!==9)return[];if(!b||typeof b!="string")return e;var h,i,j,m,n,p,q,r,s=!0,t=Sizzle.isXML(c),v=[],w=b;do{a.exec(""),h=a.exec(w);if(h){w=h[3],v.push(h[1]);if(h[2]){m=h[3];break}}}while(h);if(v.length>1&&l.exec(b))if(v.length===2&&k.relative[v[0]])i=u(v[0]+v[1],c,f);else{i=k.relative[v[0]]?[c]:Sizzle(v.shift(),c);while(v.length)b=v.shift(),k.relative[b]&&(b+=v.shift()),i=u(b,i,f)}else{!f&&v.length>1&&c.nodeType===9&&!t&&k.match.ID.test(v[0])&&!k.match.ID.test(v[v.length-1])&&(n=Sizzle.find(v.shift(),c,t),c=n.expr?Sizzle.filter(n.expr,n.set)[0]:n.set[0]);if(c){n=f?{expr:v.pop(),set:o(f)}:Sizzle.find(v.pop(),v.length!==1||v[0]!=="~"&&v[0]!=="+"||!c.parentNode?c:c.parentNode,t),i=n.expr?Sizzle.filter(n.expr,n.set):n.set,v.length>0?j=o(i):s=!1;while(v.length)p=v.pop(),q=p,k.relative[p]?q=v.pop():p="",q==null&&(q=c),k.relative[p](j,q,t)}else j=v=[]}j||(j=i),j||Sizzle.error(p||b);if(d.call(j)==="[object Array]")if(!s)e.push.apply(e,j);else if(c&&c.nodeType===1)for(r=0;j[r]!=null;r++)j[r]&&(j[r]===!0||j[r].nodeType===1&&Sizzle.contains(c,j[r]))&&e.push(i[r]);else for(r=0;j[r]!=null;r++)j[r]&&j[r].nodeType===1&&e.push(i[r]);else o(j,e);return m&&(Sizzle(m,g,e,f),Sizzle.uniqueSort(e)),e},Sizzle.uniqueSort=function(a){if(q){e=f,a.sort(q);if(e)for(var b=1;b<a.length;b++)a[b]===a[b-1]&&a.splice(b--,1)}return a},Sizzle.matches=function(a,b){return Sizzle(a,null,null,b)},Sizzle.matchesSelector=function(a,b){return Sizzle(b,null,null,[a]).length>0},Sizzle.find=function(a,b,c){var d,e,f,h,i,j;if(!a)return[];for(e=0,f=k.order.length;e<f;e++){i=k.order[e];if(h=k.leftMatch[i].exec(a)){j=h[1],h.splice(1,1);if(j.substr(j.length-1)!=="\\"){h[1]=(h[1]||"").replace(g,""),d=k.find[i](h,b,c);if(d!=null){a=a.replace(k.match[i],"");break}}}}return d||(d=typeof b.getElementsByTagName!="undefined"?b.getElementsByTagName("*"):[]),{set:d,expr:a}},Sizzle.filter=function(a,b,c,d){var e,f,g,h,i,j,l,m,n,o=a,p=[],q=b,r=b&&b[0]&&Sizzle.isXML(b[0]);while(a&&b.length){for(g in k.filter)if((e=k.leftMatch[g].exec(a))!=null&&e[2]){j=k.filter[g],l=e[1],f=!1,e.splice(1,1);if(l.substr(l.length-1)==="\\")continue;q===p&&(p=[]);if(k.preFilter[g]){e=k.preFilter[g](e,q,c,p,d,r);if(!e)f=h=!0;else if(e===!0)continue}if(e)for(m=0;(i=q[m])!=null;m++)i&&(h=j(i,e,m,q),n=d^h,c&&h!=null?n?f=!0:q[m]=!1:n&&(p.push(i),f=!0));if(h!==undefined){c||(q=p),a=a.replace(k.match[g],"");if(!f)return[];break}}if(a===o)if(f==null)Sizzle.error(a);else break;o=a}return q},Sizzle.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)};var j=Sizzle.getText=function(a){var b,c,d=a.nodeType,e="";if(d){if(d===1||d===9){if(typeof a.textContent=="string")return a.textContent;if(typeof a.innerText=="string")return a.innerText.replace(h,"");for(a=a.firstChild;a;a=a.nextSibling)e+=j(a)}else if(d===3||d===4)return a.nodeValue}else for(b=0;c=a[b];b++)c.nodeType!==8&&(e+=j(c));return e},k=Sizzle.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(a){return a.getAttribute("href")},type:function(a){return a.getAttribute("type")}},relative:{"+":function(a,b){var c=typeof b=="string",d=c&&!i.test(b),e=c&&!d;d&&(b=b.toLowerCase());for(var f=0,g=a.length,h;f<g;f++)if(h=a[f]){while((h=h.previousSibling)&&h.nodeType!==1);a[f]=e||h&&h.nodeName.toLowerCase()===b?h||!1:h===b}e&&Sizzle.filter(b,a,!0)},">":function(a,b){var c,d=typeof b=="string",e=0,f=a.length;if(d&&!i.test(b)){b=b.toLowerCase();for(;e<f;e++){c=a[e];if(c){var g=c.parentNode;a[e]=g.nodeName.toLowerCase()===b?g:!1}}}else{for(;e<f;e++)c=a[e],c&&(a[e]=d?c.parentNode:c.parentNode===b);d&&Sizzle.filter(b,a,!0)}},"":function(a,b,d){var e,f=c++,g=t;typeof b=="string"&&!i.test(b)&&(b=b.toLowerCase(),e=b,g=s),g("parentNode",b,f,a,e,d)},"~":function(a,b,d){var e,f=c++,g=t;typeof b=="string"&&!i.test(b)&&(b=b.toLowerCase(),e=b,g=s),g("previousSibling",b,f,a,e,d)}},find:{ID:function(a,b,c){if(typeof b.getElementById!="undefined"&&!c){var d=b.getElementById(a[1]);return d&&d.parentNode?[d]:[]}},NAME:function(a,b){if(typeof b.getElementsByName!="undefined"){var c=[],d=b.getElementsByName(a[1]);for(var e=0,f=d.length;e<f;e++)d[e].getAttribute("name")===a[1]&&c.push(d[e]);return c.length===0?null:c}},TAG:function(a,b){if(typeof b.getElementsByTagName!="undefined")return b.getElementsByTagName(a[1])}},preFilter:{CLASS:function(a,b,c,d,e,f){a=" "+a[1].replace(g,"")+" ";if(f)return a;for(var h=0,i;(i=b[h])!=null;h++)i&&(e^(i.className&&(" "+i.className+" ").replace(/[\t\n\r]/g," ").indexOf(a)>=0)?c||d.push(i):c&&(b[h]=!1));return!1},ID:function(a){return a[1].replace(g,"")},TAG:function(a,b){return a[1].replace(g,"").toLowerCase()},CHILD:function(a){if(a[1]==="nth"){a[2]||Sizzle.error(a[0]),a[2]=a[2].replace(/^\+|\s*/g,"");var b=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(a[2]==="even"&&"2n"||a[2]==="odd"&&"2n+1"||!/\D/.test(a[2])&&"0n+"+a[2]||a[2]);a[2]=b[1]+(b[2]||1)-0,a[3]=b[3]-0}else a[2]&&Sizzle.error(a[0]);return a[0]=c++,a},ATTR:function(a,b,c,d,e,f){var h=a[1]=a[1].replace(g,"");return!f&&k.attrMap[h]&&(a[1]=k.attrMap[h]),a[4]=(a[4]||a[5]||"").replace(g,""),a[2]==="~="&&(a[4]=" "+a[4]+" "),a},PSEUDO:function(b,c,d,e,f){if(b[1]==="not")if((a.exec(b[3])||"").length>1||/^\w/.test(b[3]))b[3]=Sizzle(b[3],null,null,c);else{var g=Sizzle.filter(b[3],c,d,!0^f);return d||e.push.apply(e,g),!1}else if(k.match.POS.test(b[0])||k.match.CHILD.test(b[0]))return!0;return b},POS:function(a){return a.unshift(!0),a}},filters:{enabled:function(a){return a.disabled===!1&&a.type!=="hidden"},disabled:function(a){return a.disabled===!0},checked:function(a){return a.checked===!0},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},parent:function(a){return!!a.firstChild},empty:function(a){return!a.firstChild},has:function(a,b,c){return!!Sizzle(c[3],a).length},header:function(a){return/h\d/i.test(a.nodeName)},text:function(a){var b=a.getAttribute("type"),c=a.type;return a.nodeName.toLowerCase()==="input"&&"text"===c&&(b===c||b===null)},radio:function(a){return a.nodeName.toLowerCase()==="input"&&"radio"===a.type},checkbox:function(a){return a.nodeName.toLowerCase()==="input"&&"checkbox"===a.type},file:function(a){return a.nodeName.toLowerCase()==="input"&&"file"===a.type},password:function(a){return a.nodeName.toLowerCase()==="input"&&"password"===a.type},submit:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"submit"===a.type},image:function(a){return a.nodeName.toLowerCase()==="input"&&"image"===a.type},reset:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"reset"===a.type},button:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&"button"===a.type||b==="button"},input:function(a){return/input|select|textarea|button/i.test(a.nodeName)},focus:function(a){return a===a.ownerDocument.activeElement}},setFilters:{first:function(a,b){return b===0},last:function(a,b,c,d){return b===d.length-1},even:function(a,b){return b%2===0},odd:function(a,b){return b%2===1},lt:function(a,b,c){return b<c[3]-0},gt:function(a,b,c){return b>c[3]-0},nth:function(a,b,c){return c[3]-0===b},eq:function(a,b,c){return c[3]-0===b}},filter:{PSEUDO:function(a,b,c,d){var e=b[1],f=k.filters[e];if(f)return f(a,c,b,d);if(e==="contains")return(a.textContent||a.innerText||j([a])||"").indexOf(b[3])>=0;if(e==="not"){var g=b[3];for(var h=0,i=g.length;h<i;h++)if(g[h]===a)return!1;return!0}Sizzle.error(e)},CHILD:function(a,c){var d,e,f,g,h,i,j,k=c[1],l=a;switch(k){case"only":case"first":while(l=l.previousSibling)if(l.nodeType===1)return!1;if(k==="first")return!0;l=a;case"last":while(l=l.nextSibling)if(l.nodeType===1)return!1;return!0;case"nth":d=c[2],e=c[3];if(d===1&&e===0)return!0;f=c[0],g=a.parentNode;if(g&&(g[b]!==f||!a.nodeIndex)){i=0;for(l=g.firstChild;l;l=l.nextSibling)l.nodeType===1&&(l.nodeIndex=++i);g[b]=f}return j=a.nodeIndex-e,d===0?j===0:j%d===0&&j/d>=0}},ID:function(a,b){return a.nodeType===1&&a.getAttribute("id")===b},TAG:function(a,b){return b==="*"&&a.nodeType===1||!!a.nodeName&&a.nodeName.toLowerCase()===b},CLASS:function(a,b){return(" "+(a.className||a.getAttribute("class"))+" ").indexOf(b)>-1},ATTR:function(a,b){var c=b[1],d=Sizzle.attr?Sizzle.attr(a,c):k.attrHandle[c]?k.attrHandle[c](a):a[c]!=null?a[c]:a.getAttribute(c),e=d+"",f=b[2],g=b[4];return d==null?f==="!=":!f&&Sizzle.attr?d!=null:f==="="?e===g:f==="*="?e.indexOf(g)>=0:f==="~="?(" "+e+" ").indexOf(g)>=0:g?f==="!="?e!==g:f==="^="?e.indexOf(g)===0:f==="$="?e.substr(e.length-g.length)===g:f==="|="?e===g||e.substr(0,g.length+1)===g+"-":!1:e&&d!==!1},POS:function(a,b,c,d){var e=b[2],f=k.setFilters[e];if(f)return f(a,c,b,d)}}},l=k.match.POS,m=function(a,b){return"\\"+(b-0+1)};for(var n in k.match)k.match[n]=new RegExp(k.match[n].source+/(?![^\[]*\])(?![^\(]*\))/.source),k.leftMatch[n]=new RegExp(/(^(?:.|\r|\n)*?)/.source+k.match[n].source.replace(/\\(\d+)/g,m));var o=function(a,b){return a=Array.prototype.slice.call(a,0),b?(b.push.apply(b,a),b):a};try{Array.prototype.slice.call(document.documentElement.childNodes,0)[0].nodeType}catch(p){o=function(a,b){var c=0,e=b||[];if(d.call(a)==="[object Array]")Array.prototype.push.apply(e,a);else if(typeof a.length=="number")for(var f=a.length;c<f;c++)e.push(a[c]);else for(;a[c];c++)e.push(a[c]);return e}}var q,r;document.documentElement.compareDocumentPosition?q=function(a,b){return a===b?(e=!0,0):!a.compareDocumentPosition||!b.compareDocumentPosition?a.compareDocumentPosition?-1:1:a.compareDocumentPosition(b)&4?-1:1}:(q=function(a,b){if(a===b)return e=!0,0;if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var c,d,f=[],g=[],h=a.parentNode,i=b.parentNode,j=h;if(h===i)return r(a,b);if(!h)return-1;if(!i)return 1;while(j)f.unshift(j),j=j.parentNode;j=i;while(j)g.unshift(j),j=j.parentNode;c=f.length,d=g.length;for(var k=0;k<c&&k<d;k++)if(f[k]!==g[k])return r(f[k],g[k]);return k===c?r(a,g[k],-1):r(f[k],b,1)},r=function(a,b,c){if(a===b)return c;var d=a.nextSibling;while(d){if(d===b)return-1;d=d.nextSibling}return 1}),function(){var a=document.createElement("div"),b="script"+(new Date).getTime(),c=document.documentElement;a.innerHTML="<a name='"+b+"'/>",c.insertBefore(a,c.firstChild),document.getElementById(b)&&(k.find.ID=function(a,b,c){if(typeof b.getElementById!="undefined"&&!c){var d=b.getElementById(a[1]);return d?d.id===a[1]||typeof d.getAttributeNode!="undefined"&&d.getAttributeNode("id").nodeValue===a[1]?[d]:undefined:[]}},k.filter.ID=function(a,b){var c=typeof a.getAttributeNode!="undefined"&&a.getAttributeNode("id");return a.nodeType===1&&c&&c.nodeValue===b}),c.removeChild(a),c=a=null}(),function(){var a=document.createElement("div");a.appendChild(document.createComment("")),a.getElementsByTagName("*").length>0&&(k.find.TAG=function(a,b){var c=b.getElementsByTagName(a[1]);if(a[1]==="*"){var d=[];for(var e=0;c[e];e++)c[e].nodeType===1&&d.push(c[e]);c=d}return c}),a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!="undefined"&&a.firstChild.getAttribute("href")!=="#"&&(k.attrHandle.href=function(a){return a.getAttribute("href",2)}),a=null}(),document.querySelectorAll&&function(){var a=Sizzle,b=document.createElement("div"),c="__sizzle__";b.innerHTML="<p class='TEST'></p>";if(b.querySelectorAll&&b.querySelectorAll(".TEST").length===0)return;Sizzle=function(b,d,e,f){d=d||document;if(!f&&!Sizzle.isXML(d)){var g=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(b);if(g&&(d.nodeType===1||d.nodeType===9)){if(g[1])return o(d.getElementsByTagName(b),e);if(g[2]&&k.find.CLASS&&d.getElementsByClassName)return o(d.getElementsByClassName(g[2]),e)}if(d.nodeType===9){if(b==="body"&&d.body)return o([d.body],e);if(g&&g[3]){var h=d.getElementById(g[3]);if(!h||!h.parentNode)return o([],e);if(h.id===g[3])return o([h],e)}try{return o(d.querySelectorAll(b),e)}catch(i){}}else if(d.nodeType===1&&d.nodeName.toLowerCase()!=="object"){var j=d,l=d.getAttribute("id"),m=l||c,n=d.parentNode,p=/^\s*[+~]/.test(b);l?m=m.replace(/'/g,"\\$&"):d.setAttribute("id",m),p&&n&&(d=d.parentNode);try{if(!p||n)return o(d.querySelectorAll("[id='"+m+"'] "+b),e)}catch(q){}finally{l||j.removeAttribute("id")}}}return a(b,d,e,f)};for(var d in a)Sizzle[d]=a[d];b=null}(),function(){var a=document.documentElement,b=a.matchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.msMatchesSelector;if(b){var c=!b.call(document.createElement("div"),"div"),d=!1;try{b.call(document.documentElement,"[test!='']:sizzle")}catch(e){d=!0}Sizzle.matchesSelector=function(a,e){e=e.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!Sizzle.isXML(a))try{if(d||!k.match.PSEUDO.test(e)&&!/!=/.test(e)){var f=b.call(a,e);if(f||!c||a.document&&a.document.nodeType!==11)return f}}catch(g){}return Sizzle(e,null,null,[a]).length>0}}}(),function(){var a=document.createElement("div");a.innerHTML="<div class='test e'></div><div class='test'></div>";if(!a.getElementsByClassName||a.getElementsByClassName("e").length===0)return;a.lastChild.className="e";if(a.getElementsByClassName("e").length===1)return;k.order.splice(1,0,"CLASS"),k.find.CLASS=function(a,b,c){if(typeof b.getElementsByClassName!="undefined"&&!c)return b.getElementsByClassName(a[1])},a=null}(),document.documentElement.contains?Sizzle.contains=function(a,b){return a!==b&&(a.contains?a.contains(b):!0)}:document.documentElement.compareDocumentPosition?Sizzle.contains=function(a,b){return!!(a.compareDocumentPosition(b)&16)}:Sizzle.contains=function(){return!1},Sizzle.isXML=function(a){var b=(a?a.ownerDocument||a:0).documentElement;return b?b.nodeName!=="HTML":!1};var u=function(a,b,c){var d,e=[],f="",g=b.nodeType?[b]:b;while(d=k.match.PSEUDO.exec(a))f+=d[0],a=a.replace(k.match.PSEUDO,"");a=k.relative[a]?a+"*":a;for(var h=0,i=g.length;h<i;h++)Sizzle(a,g[h],e,c);return Sizzle.filter(f,e)}})()}var _;(function(){function x(a,b,c){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;a._chain&&(a=a._wrapped),b._chain&&(b=b._wrapped);if(_.isFunction(a.isEqual))return a.isEqual(b);if(_.isFunction(b.isEqual))return b.isEqual(a);var d=g.call(a);if(d!=g.call(b))return!1;switch(d){case"[object String]":return String(a)==String(b);case"[object Number]":return a=+a,b=+b,a!=a?b!=b:a==0?1/a==1/b:a==b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if(typeof a!="object"||typeof b!="object")return!1;var e=c.length;while(e--)if(c[e]==a)return!0;c.push(a);var f=0,i=!0;if(d=="[object Array]"){f=a.length,i=f==b.length;if(i)while(f--)if(!(i=f in a==f in b&&x(a[f],b[f],c)))break}else{if("constructor"in a!="constructor"in b||a.constructor!=b.constructor)return!1;for(var j in a)if(h.call(a,j)){f++;if(!(i=h.call(b,j)&&x(a[j],b[j],c)))break}if(i){for(j in b)if(h.call(b,j)&&!(f--))break;i=!f}}return c.pop(),i}var a={},b=Array.prototype,c=Object.prototype,d=Function.prototype,e=b.slice,f=b.unshift,g=c.toString,h=c.hasOwnProperty,i=b.forEach,j=b.map,k=b.reduce,l=b.reduceRight,m=b.filter,n=b.every,o=b.some,p=b.indexOf,q=b.lastIndexOf,r=Array.isArray,s=Object.keys,t=d.bind;_=function(a){return new z(a)},_.VERSION="1.2.2";var u=_.each=_.forEach=function(b,c,d){if(b==null)return;if(i&&b.forEach===i)b.forEach(c,d);else if(b.length===+b.length){for(var e=0,f=b.length;e<f;e++)if(e in b&&c.call(d,b[e],e,b)===a)return}else for(var g in b)if(h.call(b,g)&&c.call(d,b[g],g,b)===a)return};_.map=function(a,b,c){var d=[];return a==null?d:j&&a.map===j?a.map(b,c):(u(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)}),d)},_.reduce=_.foldl=_.inject=function(a,b,c,d){var e=c!==void 0;a==null&&(a=[]);if(k&&a.reduce===k)return d&&(b=_.bind(b,d)),e?a.reduce(b,c):a.reduce(b);u(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)});if(!e)throw new TypeError("Reduce of empty array with no initial value");return c},_.reduceRight=_.foldr=function(a,b,c,d){a==null&&(a=[]);if(l&&a.reduceRight===l)return d&&(b=_.bind(b,d)),c!==void 0?a.reduceRight(b,c):a.reduceRight(b);var e=(_.isArray(a)?a.slice():_.toArray(a)).reverse();return _.reduce(e,b,c,d)},_.find=_.detect=function(a,b,c){var d;return v(a,function(a,e,f){if(b.call(c,a,e,f))return d=a,!0}),d},_.filter=_.select=function(a,b,c){var d=[];return a==null?d:m&&a.filter===m?a.filter(b,c):(u(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)}),d)},_.reject=function(a,b,c){var d=[];return a==null?d:(u(a,function(a,e,f){b.call(c,a,e,f)||(d[d.length]=a)}),d)},_.every=_.all=function(b,c,d){var e=!0;return b==null?e:n&&b.every===n?b.every(c,d):(u(b,function(b,f,g){if(!(e=e&&c.call(d,b,f,g)))return a}),e)};var v=_.some=_.any=function(b,c,d){c=c||_.identity;var e=!1;return b==null?e:o&&b.some===o?b.some(c,d):(u(b,function(b,f,g){if(e||(e=c.call(d,b,f,g)))return a}),!!e)};_.include=_.contains=function(a,b){var c=!1;return a==null?c:p&&a.indexOf===p?a.indexOf(b)!=-1:(c=v(a,function(a){return a===b}),c)},_.invoke=function(a,b){var c=e.call(arguments,2);return _.map(a,function(a){return(b.call?b||a:a[b]).apply(a,c)})},_.pluck=function(a,b){return _.map(a,function(a){return a[b]})},_.max=function(a,b,c){if(!b&&_.isArray(a))return Math.max.apply(Math,a);if(!b&&_.isEmpty(a))return-Infinity;var d={computed:-Infinity};return u(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>=d.computed&&(d={value:a,computed:g})}),d.value},_.min=function(a,b,c){if(!b&&_.isArray(a))return Math.min.apply(Math,a);if(!b&&_.isEmpty(a))return Infinity;var d={computed:Infinity};return u(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})}),d.value},_.shuffle=function(a){var b=[],c;return u(a,function(a,d,e){d==0?b[0]=a:(c=Math.floor(Math.random()*(d+1)),b[d]=b[c],b[c]=a)}),b},_.sortBy=function(a,b,c){return _.pluck(_.map(a,function(a,d,e){return{value:a,criteria:b.call(c,a,d,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;return c<d?-1:c>d?1:0}),"value")},_.groupBy=function(a,b){var c={},d=_.isFunction(b)?b:function(a){return a[b]};return u(a,function(a,b){var e=d(a,b);(c[e]||(c[e]=[])).push(a)}),c},_.sortedIndex=function(a,b,c){c||(c=_.identity);var d=0,e=a.length;while(d<e){var f=d+e>>1;c(a[f])<c(b)?d=f+1:e=f}return d},_.toArray=function(a){return a?a.toArray?a.toArray():_.isArray(a)?e.call(a):_.isArguments(a)?e.call(a):_.values(a):[]},_.size=function(a){return _.toArray(a).length},_.first=_.head=function(a,b,c){return b!=null&&!c?e.call(a,0,b):a[0]},_.initial=function(a,b,c){return e.call(a,0,a.length-(b==null||c?1:b))},_.last=function(a,b,c){return b!=null&&!c?e.call(a,Math.max(a.length-b,0)):a[a.length-1]},_.rest=_.tail=function(a,b,c){return e.call(a,b==null||c?1:b)},_.compact=function(a){return _.filter(a,function(a){return!!a})},_.flatten=function(a,b){return _.reduce(a,function(a,c){return _.isArray(c)?a.concat(b?c:_.flatten(c)):(a[a.length]=c,a)},[])},_.without=function(a){return _.difference(a,e.call(arguments,1))},_.uniq=_.unique=function(a,b,c){var d=c?_.map(a,c):a,e=[];return _.reduce(d,function(c,d,f){if(0==f||(b===!0?_.last(c)!=d:!_.include(c,d)))c[c.length]=d,e[e.length]=a[f];return c},[]),e},_.union=function(){return _.uniq(_.flatten(arguments,!0))},_.intersection=_.intersect=function(a){var b=e.call(arguments,1);return _.filter(_.uniq(a),function(a){return _.every(b,function(b){return _.indexOf(b,a)>=0})})},_.difference=function(a,b){return _.filter(a,function(a){return!_.include(b,a)})},_.zip=function(){var a=e.call(arguments),b=_.max(_.pluck(a,"length")),c=new Array(b);for(var d=0;d<b;d++)c[d]=_.pluck(a,""+d);return c},_.indexOf=function(a,b,c){if(a==null)return-1;var d,e;if(c)return d=_.sortedIndex(a,b),a[d]===b?d:-1;if(p&&a.indexOf===p)return a.indexOf(b);for(d=0,e=a.length;d<e;d++)if(a[d]===b)return d;return-1},_.lastIndexOf=function(a,b){if(a==null)return-1;if(q&&a.lastIndexOf===q)return a.lastIndexOf(b);var c=a.length;while(c--)if(a[c]===b)return c;return-1},_.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);while(e<d)f[e++]=a,a+=c;return f};var w=function(){};_.bind=function(a,b){var c,d;if(a.bind===t&&t)return t.apply(a,e.call(arguments,1));if(!_.isFunction(a))throw new TypeError;return d=e.call(arguments,2),c=function(){if(this instanceof c){w.prototype=a.prototype;var f=new w,g=a.apply(f,d.concat(e.call(arguments)));return Object(g)===g?g:f}return a.apply(b,d.concat(e.call(arguments)))}},_.bindAll=function(a){var b=e.call(arguments,1);return b.length==0&&(b=_.functions(a)),u(b,function(b){a[b]=_.bind(a[b],a)}),a},_.memoize=function(a,b){var c={};return b||(b=_.identity),function(){var d=b.apply(this,arguments);return h.call(c,d)?c[d]:c[d]=a.apply(this,arguments)}},_.delay=function(a,b){var c=e.call(arguments,2);return setTimeout(function(){return a.apply(a,c)},b)},_.defer=function(a){return _.delay.apply(_,[a,1].concat(e.call(arguments,1)))},_.throttle=function(a,b){var c,d,e,f,g,h=_.debounce(function(){g=f=!1},b);return function(){c=this,d=arguments;var i=function(){e=null,g&&a.apply(c,d),h()};e||(e=setTimeout(i,b)),f?g=!0:a.apply(c,d),h(),f=!0}},_.debounce=function(a,b){var c;return function(){var d=this,e=arguments,f=function(){c=null,a.apply(d,e)};clearTimeout(c),c=setTimeout(f,b)}},_.once=function(a){var b=!1,c;return function(){return b?c:(b=!0,c=a.apply(this,arguments))}},_.wrap=function(a,b){return function(){var c=[a].concat(e.call(arguments));return b.apply(this,c)}},_.compose=function(){var a=e.call(arguments);return function(){var b=e.call(arguments);for(var c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},_.after=function(a,b){return a<=0?b():function(){if(--a<1)return b.apply(this,arguments)}},_.keys=s||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)h.call(a,c)&&(b[b.length]=c);return b},_.values=function(a){return _.map(a,_.identity)},_.functions=_.methods=function(a){var b=[];for(var c in a)_.isFunction(a[c])&&b.push(c);return b.sort()},_.extend=function(a){return u(e.call(arguments,1),function(b){for(var c in b)b[c]!==void 0&&(a[c]=b[c])}),a},_.defaults=function(a){return u(e.call(arguments,1),function(b){for(var c in b)a[c]==null&&(a[c]=b[c])}),a},_.clone=function(a){return _.isObject(a)?_.isArray(a)?a.slice():_.extend({},a):a},_.tap=function(a,b){return b(a),a},_.isEqual=function(a,b){return x(a,b,[])},_.isEmpty=function(a){if(_.isArray(a)||_.isString(a))return a.length===0;for(var b in a)if(h.call(a,b))return!1;return!0},_.isElement=function(a){return!!a&&a.nodeType==1},_.isArray=r||function(a){return g.call(a)=="[object Array]"},_.isObject=function(a){return a===Object(a)},g.call(arguments)=="[object Arguments]"?_.isArguments=function(a){return g.call(a)=="[object Arguments]"}:_.isArguments=function(a){return!!a&&!!h.call(a,"callee")},_.isFunction=function(a){return g.call(a)=="[object Function]"},_.isString=function(a){return g.call(a)=="[object String]"},_.isNumber=function(a){return g.call(a)=="[object Number]"},_.isNaN=function(a){return a!==a},_.isBoolean=function(a){return a===!0||a===!1||g.call(a)=="[object Boolean]"},_.isDate=function(a){return g.call(a)=="[object Date]"},_.isRegExp=function(a){return g.call(a)=="[object RegExp]"},_.isNull=function(a){return a===null},_.isUndefined=function(a){return a===void 0},_.noConflict=function(){return root._=previousUnderscore,this},_.identity=function(a){return a},_.times=function(a,b,c){for(var d=0;d<a;d++)b.call(c,d)},_.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},_.mixin=function(a){u(_.functions(a),function(b){B(b,_[b]=a[b])})};var y=0;_.uniqueId=function(a){var b=y++;return a?a+b:b},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},_.template=function(a,b){var c=_.templateSettings,d="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+a.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(c.escape,function(a,b){return"',_.escape("+b.replace(/\\'/g,"'")+"),'"}).replace(c.interpolate,function(a,b){return"',"+b.replace(/\\'/g,"'")+",'"}).replace(c.evaluate||null,function(a,b){return"');"+b.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+";__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",e=new Function("obj","_",d);return b?e(b,_):function(a){return e(a,_)}};var z=function(a){this._wrapped=a};_.prototype=z.prototype;var A=function(a,b){return b?_(a).chain():a},B=function(a,b){z.prototype[a]=function(){var a=e.call(arguments);return f.call(a,this._wrapped),A(b.apply(_,a),this._chain)}};_.mixin(_),u(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var c=b[a];z.prototype[a]=function(){return c.apply(this._wrapped,arguments),A(this._wrapped,this._chain)}}),u(["concat","join","slice"],function(a){var c=b[a];z.prototype[a]=function(){return A(c.apply(this._wrapped,arguments),this._chain)}}),z.prototype.chain=function(){return this._chain=!0,this},z.prototype.value=function(){return this._wrapped}})();var _s;(function(){"use strict";var a=String.prototype.trim,b=function(a){return a*1||0},c=function(a,b){for(var c=[];b>0;c[--b]=a);return c.join("")},d=function(a){return Array.prototype.slice.call(a)},e=function(a){return a?_s.escapeRegExp(a):"\\s"},f=function(a){return function(){var b=d(arguments);for(var c=0;c<b.length;c++)b[c]=b[c]==null?"":""+b[c];return a.apply(null,b)}},g=function(){function a(a){return Object.prototype.toString.call(a).slice(8,-1).toLowerCase()}var b=c,d=function(){return d.cache.hasOwnProperty(arguments[0])||(d.cache[arguments[0]]=d.parse(arguments[0])),d.format.call(null,d.cache[arguments[0]],arguments)};return d.format=function(c,d){var e=1,f=c.length,h="",i,j=[],k,l,m,n,o,p;for(k=0;k<f;k++){h=a(c[k]);if(h==="string")j.push(c[k]);else if(h==="array"){m=c[k];if(m[2]){i=d[e];for(l=0;l<m[2].length;l++){if(!i.hasOwnProperty(m[2][l]))throw g('[_.sprintf] property "%s" does not exist',m[2][l]);i=i[m[2][l]]}}else m[1]?i=d[m[1]]:i=d[e++];if(/[^s]/.test(m[8])&&a(i)!="number")throw g("[_.sprintf] expecting number but found %s",a(i));switch(m[8]){case"b":i=i.toString(2);break;case"c":i=String.fromCharCode(i);break;case"d":i=parseInt(i,10);break;case"e":i=m[7]?i.toExponential(m[7]):i.toExponential();break;case"f":i=m[7]?parseFloat(i).toFixed(m[7]):parseFloat(i);break;case"o":i=i.toString(8);break;case"s":i=(i=String(i))&&m[7]?i.substring(0,m[7]):i;break;case"u":i=Math.abs(i);break;case"x":i=i.toString(16);break;case"X":i=i.toString(16).toUpperCase()}i=/[def]/.test(m[8])&&m[3]&&i>=0?"+"+i:i,o=m[4]?m[4]=="0"?"0":m[4].charAt(1):" ",p=m[6]-String(i).length,n=m[6]?b(o,p):"",j.push(m[5]?i+n:n+i)}}return j.join("")},d.cache={},d.parse=function(a){var b=a,c=[],d=[],e=0;while(b){if((c=/^[^\x25]+/.exec(b))!==null)d.push(c[0]);else if((c=/^\x25{2}/.exec(b))!==null)d.push("%");else{if((c=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(b))===null)throw"[_.sprintf] huh?";if(c[2]){e|=1;var f=[],g=c[2],h=[];if((h=/^([a-z_][a-z_\d]*)/i.exec(g))===null)throw"[_.sprintf] huh?";f.push(h[1]);while((g=g.substring(h[0].length))!=="")if((h=/^\.([a-z_][a-z_\d]*)/i.exec(g))!==null)f.push(h[1]);else if((h=/^\[(\d+)\]/.exec(g))!==null)f.push(h[1]);else throw"[_.sprintf] huh?";c[2]=f}else e|=2;if(e===3)throw"[_.sprintf] mixing positional and named placeholders is not (yet) supported";d.push(c)}b=b.substring(c[0].length)}return d},d}();_s={VERSION:"1.2.0",isBlank:f(function(a){return/^\s*$/.test(a)}),stripTags:f(function(a){return a.replace(/<\/?[^>]+>/ig,"")}),capitalize:f(function(a){return a.charAt(0).toUpperCase()+a.substring(1).toLowerCase()}),chop:f(function(a,c){c=b(c)||a.length;var d=[];for(var e=0;e<a.length;)d.push(a.slice(e,e+c)),e+=c;return d}),clean:f(function(a){return _s.strip(a.replace(/\s+/g," "))}),count:f(function(a,b){var c=0,d;for(var e=0;e<a.length;)d=a.indexOf(b,e),d>=0&&c++,e=e+(d>=0?d:0)+b.length;return c}),chars:f(function(a){return a.split("")}),escapeHTML:f(function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}),unescapeHTML:f(function(a){return a.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&amp;/g,"&")}),escapeRegExp:f(function(a){return a.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")}),insert:f(function(a,c,d){var e=a.split("");return e.splice(b(c),0,d),e.join("")}),include:f(function(a,b){return a.indexOf(b)!==-1}),join:f(function(a){var b=d(arguments);return b.join(b.shift())}),lines:f(function(a){return a.split("\n")}),reverse:f(function(a){return Array.prototype.reverse.apply(String(a).split("")).join("")}),splice:f(function(a,c,d,e){var f=a.split("");return f.splice(b(c),b(d),e),f.join("")}),startsWith:f(function(a,b){return a.length>=b.length&&a.substring(0,b.length)===b}),endsWith:f(function(a,b){return a.length>=b.length&&a.substring(a.length-b.length)===b}),succ:f(function(a){var b=a.split("");return b.splice(a.length-1,1,String.fromCharCode(a.charCodeAt(a.length-1)+1)),b.join("")}),titleize:f(function(a){var b=a.split(" "),c;for(var d=0;d<b.length;d++)c=b[d].split(""),typeof c[0]!="undefined"&&(c[0]=c[0].toUpperCase()),d+1===b.length?b[d]=c.join(""):b[d]=c.join("")+" ";return b.join("")}),camelize:f(function(a){return _s.trim(a).replace(/(\-|_|\s)+(.)?/g,function(a,b,c){return c?c.toUpperCase():""})}),underscored:function(a){return _s.trim(a).replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/\-|\s+/g,"_").toLowerCase()},dasherize:function(a){return _s.trim(a).replace(/([a-z\d])([A-Z]+)/g,"$1-$2").replace(/^([A-Z]+)/,"-$1").replace(/\_|\s+/g,"-").toLowerCase()},humanize:function(a){return _s.capitalize(this.underscored(a).replace(/_id$/,"").replace(/_/g," "))},trim:f(function(b,c){return!c&&a?a.call(b):(c=e(c),b.replace(new RegExp("^["+c+"]+|["+c+"]+$","g"),""))}),ltrim:f(function(a,b){return b=e(b),a.replace(new RegExp("^["+b+"]+","g"),"")}),rtrim:f(function(a,b){return b=e(b),a.replace(new RegExp("["+b+"]+$","g"),"")}),truncate:f(function(a,c,d){return d=d||"...",c=b(c),a.length>c?a.slice(0,c)+d:a}),prune:f(function(a,c,d){var e=function(a){return a.toUpperCase()!=a.toLowerCase()||/[-_\d]/.test(a)},f="",g="",h=0;d=d||"...",c=b(c);for(h in a)f+=e(a[h])?"A":" ";return f.substring(c-1,c+1).search(/^\w\w$/)===0?g=_s.rtrim(f.slice(0,c).replace(/([\W][\w]*)$/,"")):g=_s.rtrim(f.slice(0,c)),g=g.replace(/\W+$/,""),g.length+d.length>a.length?a:a.substring(0,g.length)+d}),words:function(a,b){return String(a).split(b||" ")},pad:f(function(a,d,e,f){var g="",h=0;d=b(d),e?e.length>1&&(e=e.charAt(0)):e=" ";switch(f){case"right":h=d-a.length,g=c(e,h),a+=g;break;case"both":h=d-a.length,g={left:c(e,Math.ceil(h/2)),right:c(e,Math.floor(h/2))},a=g.left+a+g.right;break;default:h=d-a.length,g=c(e,h),a=g+a}return a}),lpad:function(a,b,c){return _s.pad(a,b,c)},rpad:function(a,b,c){return _s.pad(a,b,c,"right")},lrpad:function(a,b,c){return _s.pad(a,b,c,"both")},sprintf:g,vsprintf:function(a,b){return b.unshift(a),g.apply(null,b)},toNumber:function(a,c){var d=b(b(a).toFixed(b(c)));return d!==0||a==="0"||a===0?d:Number.NaN},strRight:f(function(a,b){var c=b?a.indexOf(b):-1;return c!=-1?a.slice(c+b.length,a.length):a}),strRightBack:f(function(a,b){var c=b?a.lastIndexOf(b):-1;return c!=-1?a.slice(c+b.length,a.length):a}),strLeft:f(function(a,b){var c=b?a.indexOf(b):-1;return c!=-1?a.slice(0,c):a}),strLeftBack:f(function(a,b){var c=a.lastIndexOf(b);return c!=-1?a.slice(0,c):a}),exports:function(){var a={};for(var b in this){if(!this.hasOwnProperty(b)||b=="include"||b=="contains"||b=="reverse")continue;a[b]=this[b]}return a}},_s.strip=_s.trim,_s.lstrip=_s.ltrim,_s.rstrip=_s.rtrim,_s.center=_s.lrpad,_s.ljust=_s.lpad,_s.rjust=_s.rpad,_s.contains=_s.include})(),_.string=_s,_.str=_s;var $$,$B,Behavior,BinaryHeap,CATCH_E,ChangesE,ConcatE,EventStream,EventStream_api,FINALLY_E,HEAP_E,HeapStore,InternalE,Jolt,MappedE,PriorityQueue,Pulse,Pulse_cat,Pulse_catch_and_trace,Reactor,beforeNextPulse,beforeQ,changesE,cleanupQ,cleanupWeakReference,concatE,defaultCatchE,defaultFinallyE,defaultHeapE,defer,defer_high,delay,doNotPropagate,exporter,extractB,genericAttachListener,genericRemoveListener,genericRemoveWeakReference,internalE,isB,isE,isNodeJS,isP,isPropagating,lastRank,lastStamp,mapE,nextRank,nextStamp,propagateHigh,say,scheduleBefore,scheduleCleanup,sendCall,sendEvent,setPropagating,valueNow,__slice=Array.prototype.slice,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};BinaryHeap=function(){function a(a){this.scoreFunction=a!=null?a:function(a){return a},this.content=[]}return a.prototype.push=function(a){return this.content.push(a),this._bubbleUp(this.content.length-1)},a.prototype.pop=function(){var a,b;return b=this.content[0],a=this.content.pop(),this.content.length>0&&(this.content[0]=a,this._sinkDown(0)),b},a.prototype.size=function(){return this.content.length},a.prototype.remove=function(a){var b,c,d;d=this.content.length;for(c=0;0<=d?c<d:c>d;0<=d?c++:c--)if(this.content[c]===a){b=this.content.pop(),c!==d-1&&(this.content[c]=b,this.scoreFunction(b)<this.scoreFunction(a)?this._bubbleUp(c):this._sinkDown(c));return}throw new Error("Node not found.")},a.prototype._bubbleUp=function(a){var b,c,d;b=this.content[a];while(a>0){d=Math.floor((a+1)/2)-1,c=this.content[d];if(this.scoreFunction(b)<this.scoreFunction(c))this.content[d]=b,this.content[a]=c,a=d;else break}},a.prototype._sinkDown=function(a){var b,c,d,e,f,g,h,i,j,k,l;k=this.content.length,j=this.content[a],i=this.scoreFunction(j);for(;;){f=(a+1)*2,c=f-1,l=null,c<k&&(b=this.content[c],d=this.scoreFunction(b),d<i&&(l=c)),f<k&&(e=this.content[f],g=this.scoreFunction(e),h=l===null?i:d,g<h&&(l=f));if(l!==null)this.content[a]=this.content[l],this.content[l]=j,a=l;else break}},a}(),isNodeJS=Boolean(typeof process!="undefined"&&process!==null?process.pid:void 0),Jolt={},Jolt.$$=$$=function(){var a;a=1<=arguments.length?__slice.call(arguments,0):[],$$.okay==null&&(typeof Sizzle!="undefined"&&Sizzle!==null?$$.okay=1:$$.okay=-1);if($$.okay===-1)throw"Jolt.$$: Sizzle is undefined, because the document object was undefined when Jolt was loaded";return Sizzle.apply(null,a)},Jolt.say=say=function(a,b,c){var d,e,f,g,h;c==null&&(c="white");if(say.okay==null){if((typeof console=="undefined"||console===null)&&(typeof window!=="undefined"&&window!==null?window.console:void 0)==null)throw say.okay=-1,"console.log method is not available";if(typeof console=="undefined"||console===null)console=typeof window!="undefined"&&window!==null?window.console:void 0;say.console=console,say.error=console.error!=null;if(console.log==null)throw say.okay=-1,"console.log method is not available";say.okay=1;if(isNodeJS)say.clc=require("cli-color");else{say.clc={},e=["black","red","green","yellow","blue","magenta","cyan","white","gray"],f=function(a){return a};for(g=0,h=e.length;g<h;g++)d=e[g],say.clc[d]=f,say.clc[d].bold=f}}if(say.okay===-1)throw"console.log method is not available";if(b&&say.error!=null){say.console.error(say.clc.red.bold(a));return}return say.console.log(say.clc[c](a))},Jolt.PriorityQueue=PriorityQueue=function(){function a(){this.content=[]}return __extends(a,BinaryHeap),a.prototype.scoreFunction=function(a){return a.rank},a}(),lastStamp=0,nextStamp=function(){return++lastStamp},Jolt.isPropagating=isPropagating=!1,Jolt.setPropagating=setPropagating=function(a){return isPropagating=Boolean(a)},Jolt.doNotPropagate=doNotPropagate={},Jolt.propagateHigh=propagateHigh={},sendCall={name:function(){return"Jolt.sendEvent"},removeWeakReference:function(){}},isNodeJS?(Jolt.defer_high=defer_high=function(){var a,b;return b=arguments[0],a=2<=arguments.length?__slice.call(arguments,1):[],process.nextTick(function(){return b.apply(null,a)})},Jolt.delay=delay=function(){var a,b,c;return b=arguments[0],c=arguments[1],a=3<=arguments.length?__slice.call(arguments,2):[],setTimeout(function(){return b.apply(null,a)},c)}):(Jolt.defer_high=defer_high=function(){var a,b;return b=arguments[0],a=2<=arguments.length?__slice.call(arguments,1):[],defer.apply(null,[b].concat(__slice.call(a)))},Jolt.delay=delay=function(){var a,b,c;return b=arguments[0],c=arguments[1],a=3<=arguments.length?__slice.call(arguments,2):[],window.setTimeout(function(){return b.apply(null,a)},c)}),Jolt.defer=defer=function(){var a,b;return b=arguments[0],a=2<=arguments.length?__slice.call(arguments,1):[],delay.apply(null,[b,0].concat(__slice.call(a)))},Jolt.cleanupQ=cleanupQ=cleanupWeakReference=[],cleanupQ.draining=!1,cleanupQ.freq=100,cleanupQ.drain=function(){return cleanupQ.length?(cleanupQ.shift()(),delay(cleanupQ.drain,cleanupQ.freq)):cleanupQ.draining=!1},Jolt.scheduleCleanup=scheduleCleanup=function(a,b,c){a||(a=cleanupWeakReference);if(!c.cleanupScheduled){c.cleanupScheduled=!0,a.push(function(){return b.removeWeakReference(c)});if(!a.draining)return a.draining=!0,delay(a.drain,a.freq)}},Jolt.beforeQ=beforeQ=beforeNextPulse=[],beforeQ.draining=!1,beforeQ.freq=10,beforeQ.drain=function(){return beforeQ.length?(beforeQ.shift()(),delay(beforeQ.drain,beforeQ.freq)):beforeQ.draining=!1},Jolt.scheduleBefore=scheduleBefore=function(){var a,b,c;b=arguments[0],c=arguments[1],a=3<=arguments.length?__slice.call(arguments,2):[],b||(b=beforeNextPulse),b.push(function(){return c.apply(null,a)});if(!b.draining)return b.draining=!0,delay(b.drain,b.freq)},HeapStore=function(){function a(a){this.stamp=a,this.nodes=[]}return a}(),Jolt.isP=isP=function(a){return a instanceof Pulse},Jolt.Pulse=Pulse=function(){function a(a,b,c,d,e,f){this.arity=a,this.junction=b,this.sender=c,this.stamp=d,this.value=e,this.heap=f!=null?f:new HeapStore(this.stamp)}return a.prototype.propagate=function(){var a,b,c,d,e,f,g,h,i,j,k;e=arguments[0],i=arguments[1],h=arguments[2],b=arguments[3],c=5<=arguments.length?__slice.call(arguments,4):[];if(!h.weaklyHeld){if(beforeQ.length&&!b)while(beforeQ.length)beforeQ.shift()();setPropagating(!0),f=new PriorityQueue,f.push({estream:h,pulse:e,rank:h.rank});while(f.size())g=f.pop(),a=new(g.estream.PulseClass())(g.pulse.arity,g.pulse.junction,g.pulse.sender,g.pulse.stamp,g.pulse.value.slice(0),g.pulse.heap),a.heap.nodes.push(g.estream),d=(k=g.estream.PulseClass().prototype).PROPAGATE.apply(k,[a,a.sender,g.estream,b].concat(__slice.call(c))),j=!0,d!==doNotPropagate&&(d.sender=g.estream,_(g.estream.sendTo).map(function(a){return j=j&&a.weaklyHeld,a.weaklyHeld?scheduleCleanup(cleanupQ,g.estream,a):f.push({estream:a,pulse:d,rank:a.rank})}),g.estream.sendTo.length&&j&&(g.estream.weaklyHeld=!0,scheduleCleanup(cleanupQ,g.pulse.sender,g.estream)));return setPropagating(!1),a.heap}return scheduleCleanup(cleanupQ,i,h),e.heap},a.prototype.PROPAGATE=function(){var a,b,c,d,e,f;d=arguments[0],f=arguments[1],e=arguments[2],b=arguments[3],c=5<=arguments.length?__slice.call(arguments,4):[],a=e.UPDATER(d);if(a!==doNotPropagate&&!isP(a))throw setPropagating(!1),"receiver's UPDATER did not return a pulse object";return a},a}(),lastRank=0,nextRank=function(){return++lastRank},Jolt.isE=isE=function(a){return a instanceof EventStream},genericAttachListener=function(a,b){var c,d,e,f,g,h,i,j,k;if(!!isPropagating)return scheduleBefore(beforeQ,genericAttachListener,a,b);if(a.rank===b.rank)throw"<"+a.ClassName+">.attachListener: cycle detected in propagation graph";f=_.indexOf(a.sendTo,b);if(!(f+1)){a.sendTo.push(b);if(a.rank>b.rank){d=[],h={},a.__cycleSentinel__=h,g=[b];while(g.length){c=g.shift();if(c.__cycleSentinel__===h)throw a.sendTo.pop(),"<"+a.ClassName+">.attachListener: cycle detected in propagation graph";d.push(c),c.__cycleSentinel__=h,g.push.apply(g,c.sendTo)}k=[];for(i=0,j=d.length;i<j;i++)e=d[i],k.push(e.rank=nextRank());return k}}},genericRemoveListener=function(a,b){var c;if(!!isPropagating)return scheduleBefore(beforeQ,genericRemoveListener,a,b);c=_.indexOf(a.sendTo,b);if(c+1)return a.sendTo.splice(c,1)},genericRemoveWeakReference=function(a,b){var c;b.cleanupScheduled=!1;if(!!b.cleanupCanceled)return b.cleanupCanceled=null;if(!!isPropagating)return scheduleCleanup(cleanupQ,a,b);c=_.indexOf(a.sendTo,b),c+1&&a.sendTo.splice(c,1);if(!a.sendTo.length)return a.weaklyHeld=!0},Jolt.EventStream=EventStream=function(){function a(){var a,b=this;a=1<=arguments.length?__slice.call(arguments,0):[],this.rank=nextRank(),this.absRank=this.rank,this.sendTo=[],a.length&&_(_.flatten(__slice.call(a))).map(function(a){return a.attachListener(b)})}return a.prototype.attachListener=function(a){if(!isE(a))throw"<"+this.ClassName+">.attachListener: expected an EventStream";return genericAttachListener(this,a),this},a.prototype.removeListener=function(a){if(!isE(a))throw"<"+this.ClassName+">.removeListener: expected an EventStream";return genericRemoveListener(this,a),this},a.prototype.removeWeakReference=function(a){if(!isE(a))throw"<"+this.ClassName+">.removeWeakReference: expected an EventStream";return genericRemoveWeakReference(this,a),this},a.prototype.ClassName="EventStream",a.prototype.cleanupCanceled=null,a.prototype.cleanupScheduled=!1,a.prototype._mode=null,a.prototype.mode=function(a){if(!arguments.length)return this._mode;if(a==null)return this._mode=null,this;switch(a){case"sequenced":case"s":this._mode="sequenced";break;case"vectored":case"v":this._mode="vectored";break;case"zipped":case"z":this._mode="zipped";break;default:throw"<"+this.ClassName+">.mode: "+JSON.stringify(a)+" is not a valid mode"}return this},a.prototype["null"]=function(){return this.mode(null)},a.prototype.s=function(){return this.mode("sequenced")},a.prototype.sequenced=function(){return this.s()},a.prototype.v=function(){return this.mode("vectored")},a.prototype.vectored=function(){return this.v()},a.prototype.z=function(){return this.mode("zipped")},a.prototype.zipped=function(){return this.z()},a.prototype._name=null,a.prototype.name=function(a){if(!arguments.length)return this._name;if(!_.isString(a))throw"<"+this.ClassName+">.name: argument must be a string";return this._name=a,this},a.prototype._nary=!1,a.prototype.nary=function(){return this._nary=!0,this},a.prototype.isNary=function(a){return arguments.length?(this._nary=Boolean(a),this):this._nary},a.prototype.no_null_junc=!1,a.prototype._PulseClass=Pulse,a.prototype.PulseClass=function(a){if(!arguments.length)return this._PulseClass;if(!_.isFunction(a))throw"<"+this.ClassName+">.PulseClass: argument must be a function";if(!isP(new a))throw"<"+this.ClassName+">.PulseClass: argument does not construct an instanceof Pulse";return this._PulseClass=a,this},a.prototype.seq_junc_helper=function(a){var b,c;return c=this,b=[],_(a.value).each(function(a){return a.junction?b=b.concat(c.seq_junc_helper(a)):b=b.concat(a.value)}),b},a.prototype.vec_junc_helper=function(a){var b,c;return c=this,b=[],_(a.value).each(function(a){return a.junction?b=b.concat(c.vec_junc_helper(a)):b.push(a.value)}),b},a.prototype.zip_junc_helper=function(a){return _.zip.apply(_,this.vec_junc_helper(a))},a.prototype.tranRCV=function(a){switch(this.mode()){case"sequenced":if(a.junction)a.value=this.seq_junc_helper(a);else return a;break;case"vectored":if(a.junction)a.value=this.vec_junc_helper(a);else return a.value=[a.value],a.arity=1,a;break;case"zipped":if(a.junction)a.value=this.zip_junc_helper(a);else return a.value=_(a.value).zip(),a;break;case null:if(a.junction&&this.no_null_junc)throw"<"+this.ClassName+">.transRCV: does not support null mode for pulse junctions";return a;default:throw"<"+this.ClassName+">.transRCV: bad mode value "+JSON.stringify(this.mode())}return a.arity=a.value.length,a.junction=!1,a},a.prototype.tranOUT=function(a){var b;return a!==doNotPropagate&&this.isNary()&&(b=[],_(a.value).each(function(a){return b=b.concat(a)}),a.value=b),a},a.prototype.tranVAL=function(a){var b,c;switch(this.mode()){case null:case"sequenced":b=this.updater.apply(this,a.value),b===doNotPropagate?a=b:a.value=b;break;case"vectored":case"zipped":c=this,b=[],_(a.value).each(function(a){var d;d=c.updater.apply(c,a);if(d!==doNotPropagate)return b.push(d)}),b.length===0?a=doNotPropagate:a.value=b;break;default:throw"<"+this.ClassName+">.UPDATER: bad mode value "+JSON.stringify(this.mode())}return a},a.prototype.updater=function(){var a;return a=1<=arguments.length?__slice.call(arguments,0):[],a},a.prototype.UPDATER=function(a){return this.tranOUT(this.tranVAL(this.tranRCV(a)))},a.prototype.weaklyHeld=!1,a}(),Jolt.sendEvent=sendEvent=function(){var a,b,c,d,e,f,g;b=arguments[0],g=2<=arguments.length?__slice.call(arguments,1):[],c=!1,d=g[g.length-1],d===propagateHigh&&(c=!0,g.pop()),f=b.PulseClass(),e=g.length,a=new f(e,!1,sendCall,nextStamp(),g),f.prototype.propagate(a,a.sender,b,c);return},Jolt.EventStream_api=EventStream_api=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,EventStream),a}(),Jolt.InternalE=InternalE=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,EventStream_api),a.prototype.ClassName="InternalE",a.factory=function(){var a;return a=1<=arguments.length?__slice.call(arguments,0):[],function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return typeof e=="object"?e:d}(this,a,function(){})},a}(),Jolt.internalE=internalE=function(){var a;return a=1<=arguments.length?__slice.call(arguments,0):[],InternalE.factory.apply(InternalE,a)},EventStream_api.prototype.internalE=function(){var a;return a=1<=arguments.length?__slice.call(arguments,0):[],internalE.apply(null,__slice.call(a).concat([this]))},Jolt.ConcatE=ConcatE=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,EventStream_api),a.prototype.ClassName="ConcatE",a.factory=function(){var a;return a=1<=arguments.length?__slice.call(arguments,0):[],function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return typeof e=="object"?e:d}(this,a,function(){})},a.prototype.updater=function(){var a,b;return a=1<=arguments.length?__slice.call(arguments,0):[],(b=[]).concat.apply(b,a)},a}(),Jolt.concatE=concatE=function(){var a;return a=1<=arguments.length?__slice.call(arguments,0):[],ConcatE.factory.apply(ConcatE,a)},EventStream_api.prototype.concatE=function(){var a;return a=1<=arguments.length?__slice.call(arguments,0):[],concatE.apply(null,(a.push(this),a))},Jolt.MappedE=MappedE=function(){function a(){var b,c;c=arguments[0],b=2<=arguments.length?__slice.call(arguments,1):[],this.fn=c,a.__super__.constructor.apply(this,b)}return __extends(a,EventStream_api),a.prototype.ClassName="MappedE",a.factory=function(){var a,b;b=arguments[0],a=2<=arguments.length?__slice.call(arguments,1):[];if(!_.isFunction(b))throw"<"+this.prototype.ClassName+">.factory: 1st argument must be a function";return function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return typeof e=="object"?e:d}(this,[b].concat(__slice.call(a)),function(){})},a.prototype.updater=function(){var a,b;return b=1<=arguments.length?__slice.call(arguments,0):[],a=this.fn,[a.apply(null,b)]},a}(),Jolt.mapE=mapE=function(){var a;return a=1<=arguments.length?__slice.call(arguments,0):[],MappedE.factory.apply(MappedE,a)},EventStream_api.prototype.mapE=function(){var a;return a=1<=arguments.length?__slice.call(arguments,0):[],mapE.apply(null,(a.push(this),a))},Jolt.Pulse_cat=Jolt.Pulse_catch_and_trace=Pulse_cat=Pulse_catch_and_trace=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,Pulse),a.prototype.propagate=function(b,c,d,e,f,g,h){var i,j,k,l,m,n,o;i=b.heap,o=123,!f&&!g&&!h?(n=new Date,l=b.stamp,k=new Pulse_cat(2,!1,c,l,["start",n],new HeapStore(l)),this.constructor.prototype.propagate(k,k.sender,HEAP_E,!0,!0,!1,!1),setPropagating(!0)):"do",j=null;try{i=a.__super__.propagate.call(this,b,c,d,e,f,g,h)}catch(p){j=p}finally{!f&&!g&&!h?(m=new Date,k=new Pulse_cat(5,!1,c,l,["end",m,m-n,o,i],new HeapStore(l)),this.constructor.prototype.propagate(k,k.sender,HEAP_E,!0,!0,!1,!1)):"do";if(j)throw j}return i},a.prototype.PROPAGATE=function(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;i=!1,h=null,r=new Date,n=["tranRCV","tranVAL","tranOUT"],s={};try{o={arity:a.arity,junction:a.junction,stamp:a.stamp,value:a.value.slice(0)},q={};for(t=0,w=n.length;t<w;t++)m=n[t],q[m]=c[m];j=function(a){return c[a]=function(b){var d,e;return e=(new Date).valueOf(),d=q[a].call(c,b),s[a]=(new Date).valueOf()-e,d}};for(u=0,x=n.length;u<x;u++)m=n[u],j(m);h=c.UPDATER(a);if(h!==doNotPropagate&&!isP(h))throw h=null,"receiver's UPDATER did not return a pulse object"}catch(z){if(!e&&!f&&!g)i=!0,p=a.stamp,k=new Pulse_cat(5,!1,c,p,[z,o,b,c,r],new HeapStore(p)),this.constructor.prototype.propagate(k,k.sender,CATCH_E,!0,!1,!0,!1),setPropagating(!0);else throw setPropagating(!1),z}finally{for(v=0,y=n.length;v<y;v++)m=n[v],c[m]=q[m];!e&&!f&&!g&&!i&&(p=a.stamp,l=new Pulse_cat(4,!1,c,p,[o,h,b,c,r,s],new HeapStore(p)),this.constructor.prototype.propagate(l,l.sender,FINALLY_E,!0,!1,!1,!0),setPropagating(!0))}return h!=null?h:h=doNotPropagate},a}(),Jolt.HEAP_E=HEAP_E=internalE().name("Jolt.HEAP_E").PulseClass(Pulse_cat),Jolt.CATCH_E=CATCH_E=internalE().name("Jolt.CATCH_E").PulseClass(Pulse_cat),Jolt.FINALLY_E=FINALLY_E=internalE().name("Jolt.FINALLY_E").PulseClass(Pulse_cat),Jolt.defaultHeapE=defaultHeapE=HEAP_E.mapE(function(a,b,c,d,e){var f;switch(a){case"start":return f="----HEAP-START----\n"+b+"\nepoch: "+b.valueOf(),say(f,!1,"green");case"end":return f="----HEAP-END-----\n"+b+"\nepoch:   "+b.valueOf()+"\n  (time in ms)\nelapsed:  "+c+"\ntrace:    "+0+"\nest. net: "+0,say(f,!1,"blue")}}).name("Jolt.defaultHeapE").PulseClass(Pulse_cat),Jolt.defaultCatchE=defaultCatchE=CATCH_E.mapE(function(a,b,c,d,e){var f,g,h,i,j,k;return typeof a=="string"?f=a:a.message!=null?f=a.message:f=JSON.stringify(a),f===""&&(f="undefined"),f==null&&(f="undefined"),k=c.name(),k==null&&(k="unnamed"),j="("+c.ClassName+")",j==="(undefined)"&&(j=""),i=d.name(),i==null&&(i="unnamed"),h="("+d.ClassName+")",g="------ERROR------\nsender:    "+k+"  "+j+"\n  rank:    "+(c.rank||"n/a")+"\n  absRank: "+(c.absRank||"n/a")+"\nreceiver:  "+i+"  "+h+"\n  mode:    "+d.mode()+"\n  nary:    "+d.isNary()+"\n  rank:    "+d.rank+"\n  absRank: "+d.absRank+"\nerror:     "+f+"\n----RECV-PULSE---\narity:     "+b.arity+"\njunction:  "+b.junction+"\nstamp:     "+b.stamp+"\nvalue:     "+JSON.stringify(b.value),say(g,!0)}).name("Jolt.defaultCatchE").PulseClass(Pulse_cat),Jolt.defaultFinallyE=defaultFinallyE=FINALLY_E.mapE(function(a,b,c,d,e,f){var g,h,i,j,k;return k=c.name(),k==null&&(k="unnamed"),j="("+c.ClassName+")",j==="(undefined)"&&(j=""),i=d.name(),i==null&&(i="unnamed"),h="("+d.ClassName+")",g="------TRACE------\nsender:    "+k+"  "+j+"\n  rank:    "+(c.rank||"n/a")+"\n  absRank: "+(c.absRank||"n/a")+"\nreceiver:  "+i+"  "+h+"\n  mode:    "+d.mode()+"\n  nary:    "+d.isNary()+"\n  rank:    "+d.rank+"\n  absRank: "+d.absRank+"\n----RCV-PULSE----\narity:     "+a.arity+"\njunction:  "+a.junction+"\nstamp:     "+a.stamp+"\nvalue:     "+JSON.stringify(a.value)+"\n----OUT-PULSE----\narity:     "+b.arity+"\njunction:  "+b.junction+"\nstamp:     "+b.stamp+"\nvalue:     "+JSON.stringify(b.value)+"\n-----PROFILE-----\n  (time in ms)\ntranRCV: "+f.tranRCV+"\ntranVAL: "+f.tranVAL+"\ntranOUT: "+f.tranOUT,say(g)}).name("Jolt.defaultFinallyE").PulseClass(Pulse_cat),Jolt.isB=isB=function(a){return a instanceof Behavior},ChangesE=function(){function a(b){var c;a.__super__.constructor.call(this,b),c=b.name(),c?this._name=c+" changes":this._name="absRank "+b.absRank+" changes"}return __extends(a,InternalE),a.prototype.ClassName="ChangesE",a.factory=function(a){return new this(a)},a}(),changesE=function(a){return ChangesE.factory(a)},Jolt.Behavior=Behavior=function(){function a(){var b,c,d;d=arguments[0],b=2<=arguments.length?__slice.call(arguments,1):[],a.__super__.constructor.call(this,d),c=b.length,this.last={arity:c?c:(b.push(void 0),c+=1),value:b},this._changes=null}return __extends(a,EventStream),a.prototype.changes=function(){return this._changes==null&&(this._changes=changesE(this)),this._changes},a.prototype.ClassName="Behavior",a.prototype.no_null_junc=!0,a.prototype.UPDATER=function(b){var c;return a.__super__.UPDATER.apply(this,arguments),c=b.value,this.last={arity:c.length,value:c},b},a.factory=function(){var a;return a=1<=arguments.length?__slice.call(arguments,0):[],function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return typeof e=="object"?e:d}(this,a,function(){})},a}(),Jolt.valueNow=valueNow=function(a){return a.last.value},Behavior.prototype.valueNow=function(a){return valueNow(this)},Jolt.$B=Jolt.extractB=$B=extractB=function(){var a;return a=1<=arguments.length?__slice.call(arguments,0):[],Behavior.factory.apply(Behavior,a)},EventStream_api.prototype.$B=EventStream_api.prototype.extractB=function(){var a;return a=1<=arguments.length?__slice.call(arguments,0):[],extractB.apply(null,[this].concat(__slice.call(a)))},Jolt.Reactor=Reactor=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,EventEmitter),a}(),exporter=function(a,b){var c,d,e;a==null&&(a=Jolt),b==null&&(b=exports),e=[];for(c in a){if(!__hasProp.call(a,c))continue;d=a[c],e.push(b[c]=a[c])}return e},Jolt._=_,Jolt._s=_s,Jolt.EventEmitter2=EventEmitter,Jolt.globalize=function(){var a,b,c,d,e;a=1<=arguments.length?__slice.call(arguments,0):[],c=typeof window!="undefined"&&window!==null?window:typeof global!="undefined"&&global!==null?global:{},a.length||exporter(Jolt,c);for(d=0,e=a.length;d<e;d++)b=a[d],exporter(b,c)},exporter()
}).call(this, ((typeof exports !== 'undefined') ? exports : (this.previousJolt = this.Jolt, this.Jolt = {}, this.Jolt)))

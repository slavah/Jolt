/*/////////////////////////////// JOLT /////////////////////////////////
 *
 * Reactive Objects for JavaScript
 * https://github.com/projexsys/Jolt
 *
 * This software is Copyright (c) 2011 by Projexsys, Inc.
 *
 * This is free software, licensed under:
 *
 * The GNU General Public License Version 3
 *
 * The JavaScript code developed and owned by Projexsys, Inc. in this
 * page is free software: you can redistribute it and/or modify it under
 * the terms of the GNU General Public License (GNU GPL) as published by
 * the Free Software Foundation, either version 3 of the License, or (at
 * your option) any later version. The code is distributed WITHOUT ANY
 * WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE. See the GNU GPL for more details:
 *
 * https://raw.github.com/projexsys/Jolt/master/LICENSE
 * http://www.gnu.org/licenses/gpl-3.0.txt
 *
 * However, if you have executed an End User Software License and
 * Services Agreement or an OEM Software License and Support Services
 * Agreement, or another commercial license agreement with Projexsys,
 * Inc. (each, a "Commercial Agreement"), the terms of the license in
 * such Commercial Agreement will supersede the GNU GENERAL PUBLIC
 * LICENSE Version 3 and you may use the Software solely pursuant to the
 * terms of the relevant Commercial Agreement.
 *
//////////////////////////////// CREDIT ////////////////////////////////
 *
 * This sofware is derived from and incorporates existing works:
 *
 *  https://github.com/brownplt/flapjax
 *  https://github.com/hij1nx/EventEmitter2
 *  https://github.com/documentcloud/underscore
 *  https://github.com/autotelicum/Smooth-CoffeeScript
 *
 * For further information and license texts please refer to:
 * https://raw.github.com/projexsys/Jolt/master/LICENSES
 *
/*//////////////////////////////////////////////////////////////////////


;(function (exports, undefined) {
  var EventEmitter;(function(a){function d(){this._events=new Object}function e(a){a&&(this.wildcard=a.wildcard,this.delimiter=a.delimiter||".",this.wildcard&&(this.listenerTree=new Object))}function f(a,b,c,d){if(!c)return;var e,g,h,i,j,k,l,m,n=b.length,o=b[d],p=b[d+1];if(d===n&&c._listeners){if(typeof c._listeners=="function")return a&&a.push(c._listeners),c;for(g=0,h=c._listeners.length;g<h;g++)a&&a.push(c._listeners[g]);return c}if(o==="*"||o==="**"||c[o]){if(o==="*"){for(i in c)i!=="_listeners"&&c.hasOwnProperty(i)&&(e=f(a,b,c[i],d+1));return e}if(o==="**"){m=d+1===n||d+2===n&&p==="*",m&&c._listeners&&(e=f(a,b,c,n));for(i in c)i!=="_listeners"&&c.hasOwnProperty(i)&&(i==="*"||i==="**"?(c[i]._listeners&&!m&&(e=f(a,b,c[i],n)),e=f(a,b,c[i],d)):i===p?e=f(a,b,c[i],d+2):e=f(a,b,c[i],d));return e}e=f(a,b,c[o],d+1)}j=c["*"],j&&f(a,b,j,d+1),k=c["**"];if(k)if(d<n){k._listeners&&f(a,b,k,n);for(i in k)i!=="_listeners"&&k.hasOwnProperty(i)&&(i===p?f(a,b,k[i],d+2):i===o?f(a,b,k[i],d+1):(l={},l[i]=k[i],f(a,b,{"**":l},d+1)))}else k._listeners?f(a,b,k,n):k["*"]&&k["*"]._listeners&&f(a,b,k["*"],n);return e}function g(a,d){a=typeof a=="string"?a.split(this.delimiter):a.slice();for(var e=0,f=a.length;e+1<f;e++)if(a[e]==="**"&&a[e+1]==="**")return;var g=this.listenerTree,h=a.shift();while(h){g[h]||(g[h]=new Object),g=g[h];if(a.length===0){if(!g._listeners)g._listeners=d;else if(typeof g._listeners=="function")g._listeners=[g._listeners,d];else if(b(g._listeners)){g._listeners.push(d);if(!g._listeners.warned){var i=c;i>0&&g._listeners.length>i&&(g._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",g._listeners.length),console.trace())}}return!0}h=a.shift()}return!0}var b=Array.isArray?Array.isArray:function(a){return Object.prototype.toString.call(a)==="[object Array]"},c=10;EventEmitter=function(a){this._events=new Object,e.call(this,a)},EventEmitter.prototype.setMaxListeners=function(a){this._events||d.call(this),this._events.maxListeners=a},EventEmitter.prototype.event="",EventEmitter.prototype.once=function(a,b){return this.many(a,1,b),this},EventEmitter.prototype.many=function(a,b,c){function e(){--b===0&&d.off(a,e),c.apply(this,arguments)}var d=this;if(typeof c!="function")throw new Error("many only accepts instances of Function");return e._origin=c,this.on(a,e),d},EventEmitter.prototype.emit=function(){this._events||d.call(this);var a=arguments[0];if(a==="newListener"&&!this._events.newListener)return!1;if(this._all){var b=arguments.length,c=new Array(b-1);for(var e=1;e<b;e++)c[e-1]=arguments[e];for(e=0,b=this._all.length;e<b;e++)this.event=a,this._all[e].apply(this,c)}if(a==="error"&&!this._all&&!this._events.error&&(!this.wildcard||!this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var g;if(this.wildcard){g=[];var h=typeof a=="string"?a.split(this.delimiter):a.slice();f.call(this,g,h,this.listenerTree,0)}else g=this._events[a];if(typeof g=="function"){this.event=a;if(arguments.length===1)g.call(this);else if(arguments.length>1)switch(arguments.length){case 2:g.call(this,arguments[1]);break;case 3:g.call(this,arguments[1],arguments[2]);break;default:var b=arguments.length,c=new Array(b-1);for(var e=1;e<b;e++)c[e-1]=arguments[e];g.apply(this,c)}return!0}if(g){var b=arguments.length,c=new Array(b-1);for(var e=1;e<b;e++)c[e-1]=arguments[e];var i=g.slice();for(var e=0,b=i.length;e<b;e++)this.event=a,i[e].apply(this,c);return!0}},EventEmitter.prototype.on=function(e,f){this._events||d.call(this),this.emit("newListener",e,f);if(this.wildcard)return g.call(this,e,f),this;if(!this._events[e])this._events[e]=f;else if(typeof this._events[e]=="function")this._events[e]=[this._events[e],f];else if(b(this._events[e])){this._events[e].push(f);if(!this._events[e].warned){var h;this._events.maxListeners!==a?h=this._events.maxListeners:h=c,h&&h>0&&this._events[e].length>h&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace())}}return this},EventEmitter.prototype.onAny=function(a){this._all||(this._all=[]);if(typeof a!="function")throw new Error("onAny only accepts instances of Function");return this._all.push(a),this},EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prototype.off=function(a,c){if(typeof c!="function")throw new Error("removeListener only takes instances of Function");var d;if(this.wildcard){var e=typeof a=="string"?a.split(this.delimiter):a.slice(),g=f.call(this,null,e,this.listenerTree,0);if("undefined"==typeof g)return this;d=g._listeners}else{if(!this._events[a])return this;d=this._events[a]}if(b(d)){var h=-1;for(var i=0,j=d.length;i<j;i++)if(d[i]===c||d[i].listener&&d[i].listener===c||d[i]._origin&&d[i]._origin===c){h=i;break}if(h<0)return this;this.wildcard?g._listeners.splice(h,1):this._events[a].splice(h,1),d.length===0&&(this.wildcard?delete g._listeners:delete this._events[a])}else if(d===c||d.listener&&d.listener===c||d._origin&&d._origin===c)this.wildcard?delete g._listeners:delete this._events[a];return this},EventEmitter.prototype.offAny=function(a){var b=0,c=0,d;if(a&&this._all&&this._all.length>0){d=this._all;for(b=0,c=d.length;b<c;b++)if(a===d[b])return d.splice(b,1),this}else this._all=[];return this},EventEmitter.prototype.removeListener=EventEmitter.prototype.off,EventEmitter.prototype.removeAllListeners=function(a){if(arguments.length===0)return!this._events||d.call(this),this;if(this.wildcard){var b=typeof a=="string"?a.split(this.delimiter):a.slice(),c=f.call(this,null,b,this.listenerTree,0);if("undefined"==typeof c)return this;c._listeners=null}else{if(!this._events[a])return this;this._events[a]=null}return this},EventEmitter.prototype.listeners=function(a){if(this.wildcard){var c=[],e=typeof a=="string"?a.split(this.delimiter):a.slice();return f.call(this,c,e,this.listenerTree,0),c}return this._events||d.call(this),this._events[a]||(this._events[a]=[]),b(this._events[a])||(this._events[a]=[this._events[a]]),this._events[a]},EventEmitter.prototype.listenersAny=function(){return this._all?this._all:[]}})();var _;(function(){function x(a,b,c){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;a._chain&&(a=a._wrapped),b._chain&&(b=b._wrapped);if(_.isFunction(a.isEqual))return a.isEqual(b);if(_.isFunction(b.isEqual))return b.isEqual(a);var d=g.call(a);if(d!=g.call(b))return!1;switch(d){case"[object String]":return String(a)==String(b);case"[object Number]":return a=+a,b=+b,a!=a?b!=b:a==0?1/a==1/b:a==b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if(typeof a!="object"||typeof b!="object")return!1;var e=c.length;while(e--)if(c[e]==a)return!0;c.push(a);var f=0,i=!0;if(d=="[object Array]"){f=a.length,i=f==b.length;if(i)while(f--)if(!(i=f in a==f in b&&x(a[f],b[f],c)))break}else{if("constructor"in a!="constructor"in b||a.constructor!=b.constructor)return!1;for(var j in a)if(h.call(a,j)){f++;if(!(i=h.call(b,j)&&x(a[j],b[j],c)))break}if(i){for(j in b)if(h.call(b,j)&&!(f--))break;i=!f}}return c.pop(),i}var a={},b=Array.prototype,c=Object.prototype,d=Function.prototype,e=b.slice,f=b.unshift,g=c.toString,h=c.hasOwnProperty,i=b.forEach,j=b.map,k=b.reduce,l=b.reduceRight,m=b.filter,n=b.every,o=b.some,p=b.indexOf,q=b.lastIndexOf,r=Array.isArray,s=Object.keys,t=d.bind;_=function(a){return new z(a)},_.VERSION="1.2.2";var u=_.each=_.forEach=function(b,c,d){if(b==null)return;if(i&&b.forEach===i)b.forEach(c,d);else if(b.length===+b.length){for(var e=0,f=b.length;e<f;e++)if(e in b&&c.call(d,b[e],e,b)===a)return}else for(var g in b)if(h.call(b,g)&&c.call(d,b[g],g,b)===a)return};_.map=function(a,b,c){var d=[];return a==null?d:j&&a.map===j?a.map(b,c):(u(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)}),d)},_.reduce=_.foldl=_.inject=function(a,b,c,d){var e=c!==void 0;a==null&&(a=[]);if(k&&a.reduce===k)return d&&(b=_.bind(b,d)),e?a.reduce(b,c):a.reduce(b);u(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)});if(!e)throw new TypeError("Reduce of empty array with no initial value");return c},_.reduceRight=_.foldr=function(a,b,c,d){a==null&&(a=[]);if(l&&a.reduceRight===l)return d&&(b=_.bind(b,d)),c!==void 0?a.reduceRight(b,c):a.reduceRight(b);var e=(_.isArray(a)?a.slice():_.toArray(a)).reverse();return _.reduce(e,b,c,d)},_.find=_.detect=function(a,b,c){var d;return v(a,function(a,e,f){if(b.call(c,a,e,f))return d=a,!0}),d},_.filter=_.select=function(a,b,c){var d=[];return a==null?d:m&&a.filter===m?a.filter(b,c):(u(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)}),d)},_.reject=function(a,b,c){var d=[];return a==null?d:(u(a,function(a,e,f){b.call(c,a,e,f)||(d[d.length]=a)}),d)},_.every=_.all=function(b,c,d){var e=!0;return b==null?e:n&&b.every===n?b.every(c,d):(u(b,function(b,f,g){if(!(e=e&&c.call(d,b,f,g)))return a}),e)};var v=_.some=_.any=function(b,c,d){c=c||_.identity;var e=!1;return b==null?e:o&&b.some===o?b.some(c,d):(u(b,function(b,f,g){if(e||(e=c.call(d,b,f,g)))return a}),!!e)};_.include=_.contains=function(a,b){var c=!1;return a==null?c:p&&a.indexOf===p?a.indexOf(b)!=-1:(c=v(a,function(a){return a===b}),c)},_.invoke=function(a,b){var c=e.call(arguments,2);return _.map(a,function(a){return(b.call?b||a:a[b]).apply(a,c)})},_.pluck=function(a,b){return _.map(a,function(a){return a[b]})},_.max=function(a,b,c){if(!b&&_.isArray(a))return Math.max.apply(Math,a);if(!b&&_.isEmpty(a))return-Infinity;var d={computed:-Infinity};return u(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>=d.computed&&(d={value:a,computed:g})}),d.value},_.min=function(a,b,c){if(!b&&_.isArray(a))return Math.min.apply(Math,a);if(!b&&_.isEmpty(a))return Infinity;var d={computed:Infinity};return u(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})}),d.value},_.shuffle=function(a){var b=[],c;return u(a,function(a,d,e){d==0?b[0]=a:(c=Math.floor(Math.random()*(d+1)),b[d]=b[c],b[c]=a)}),b},_.sortBy=function(a,b,c){return _.pluck(_.map(a,function(a,d,e){return{value:a,criteria:b.call(c,a,d,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;return c<d?-1:c>d?1:0}),"value")},_.groupBy=function(a,b){var c={},d=_.isFunction(b)?b:function(a){return a[b]};return u(a,function(a,b){var e=d(a,b);(c[e]||(c[e]=[])).push(a)}),c},_.sortedIndex=function(a,b,c){c||(c=_.identity);var d=0,e=a.length;while(d<e){var f=d+e>>1;c(a[f])<c(b)?d=f+1:e=f}return d},_.toArray=function(a){return a?a.toArray?a.toArray():_.isArray(a)?e.call(a):_.isArguments(a)?e.call(a):_.values(a):[]},_.size=function(a){return _.toArray(a).length},_.first=_.head=function(a,b,c){return b!=null&&!c?e.call(a,0,b):a[0]},_.initial=function(a,b,c){return e.call(a,0,a.length-(b==null||c?1:b))},_.last=function(a,b,c){return b!=null&&!c?e.call(a,Math.max(a.length-b,0)):a[a.length-1]},_.rest=_.tail=function(a,b,c){return e.call(a,b==null||c?1:b)},_.compact=function(a){return _.filter(a,function(a){return!!a})},_.flatten=function(a,b){return _.reduce(a,function(a,c){return _.isArray(c)?a.concat(b?c:_.flatten(c)):(a[a.length]=c,a)},[])},_.without=function(a){return _.difference(a,e.call(arguments,1))},_.uniq=_.unique=function(a,b,c){var d=c?_.map(a,c):a,e=[];return _.reduce(d,function(c,d,f){if(0==f||(b===!0?_.last(c)!=d:!_.include(c,d)))c[c.length]=d,e[e.length]=a[f];return c},[]),e},_.union=function(){return _.uniq(_.flatten(arguments,!0))},_.intersection=_.intersect=function(a){var b=e.call(arguments,1);return _.filter(_.uniq(a),function(a){return _.every(b,function(b){return _.indexOf(b,a)>=0})})},_.difference=function(a,b){return _.filter(a,function(a){return!_.include(b,a)})},_.zip=function(){var a=e.call(arguments),b=_.max(_.pluck(a,"length")),c=new Array(b);for(var d=0;d<b;d++)c[d]=_.pluck(a,""+d);return c},_.indexOf=function(a,b,c){if(a==null)return-1;var d,e;if(c)return d=_.sortedIndex(a,b),a[d]===b?d:-1;if(p&&a.indexOf===p)return a.indexOf(b);for(d=0,e=a.length;d<e;d++)if(a[d]===b)return d;return-1},_.lastIndexOf=function(a,b){if(a==null)return-1;if(q&&a.lastIndexOf===q)return a.lastIndexOf(b);var c=a.length;while(c--)if(a[c]===b)return c;return-1},_.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);while(e<d)f[e++]=a,a+=c;return f};var w=function(){};_.bind=function(a,b){var c,d;if(a.bind===t&&t)return t.apply(a,e.call(arguments,1));if(!_.isFunction(a))throw new TypeError;return d=e.call(arguments,2),c=function(){if(this instanceof c){w.prototype=a.prototype;var f=new w,g=a.apply(f,d.concat(e.call(arguments)));return Object(g)===g?g:f}return a.apply(b,d.concat(e.call(arguments)))}},_.bindAll=function(a){var b=e.call(arguments,1);return b.length==0&&(b=_.functions(a)),u(b,function(b){a[b]=_.bind(a[b],a)}),a},_.memoize=function(a,b){var c={};return b||(b=_.identity),function(){var d=b.apply(this,arguments);return h.call(c,d)?c[d]:c[d]=a.apply(this,arguments)}},_.delay=function(a,b){var c=e.call(arguments,2);return setTimeout(function(){return a.apply(a,c)},b)},_.defer=function(a){return _.delay.apply(_,[a,1].concat(e.call(arguments,1)))},_.throttle=function(a,b){var c,d,e,f,g,h=_.debounce(function(){g=f=!1},b);return function(){c=this,d=arguments;var i=function(){e=null,g&&a.apply(c,d),h()};e||(e=setTimeout(i,b)),f?g=!0:a.apply(c,d),h(),f=!0}},_.debounce=function(a,b){var c;return function(){var d=this,e=arguments,f=function(){c=null,a.apply(d,e)};clearTimeout(c),c=setTimeout(f,b)}},_.once=function(a){var b=!1,c;return function(){return b?c:(b=!0,c=a.apply(this,arguments))}},_.wrap=function(a,b){return function(){var c=[a].concat(e.call(arguments));return b.apply(this,c)}},_.compose=function(){var a=e.call(arguments);return function(){var b=e.call(arguments);for(var c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},_.after=function(a,b){return a<=0?b():function(){if(--a<1)return b.apply(this,arguments)}},_.keys=s||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)h.call(a,c)&&(b[b.length]=c);return b},_.values=function(a){return _.map(a,_.identity)},_.functions=_.methods=function(a){var b=[];for(var c in a)_.isFunction(a[c])&&b.push(c);return b.sort()},_.extend=function(a){return u(e.call(arguments,1),function(b){for(var c in b)b[c]!==void 0&&(a[c]=b[c])}),a},_.defaults=function(a){return u(e.call(arguments,1),function(b){for(var c in b)a[c]==null&&(a[c]=b[c])}),a},_.clone=function(a){return _.isObject(a)?_.isArray(a)?a.slice():_.extend({},a):a},_.tap=function(a,b){return b(a),a},_.isEqual=function(a,b){return x(a,b,[])},_.isEmpty=function(a){if(_.isArray(a)||_.isString(a))return a.length===0;for(var b in a)if(h.call(a,b))return!1;return!0},_.isElement=function(a){return!!a&&a.nodeType==1},_.isArray=r||function(a){return g.call(a)=="[object Array]"},_.isObject=function(a){return a===Object(a)},g.call(arguments)=="[object Arguments]"?_.isArguments=function(a){return g.call(a)=="[object Arguments]"}:_.isArguments=function(a){return!!a&&!!h.call(a,"callee")},_.isFunction=function(a){return g.call(a)=="[object Function]"},_.isString=function(a){return g.call(a)=="[object String]"},_.isNumber=function(a){return g.call(a)=="[object Number]"},_.isNaN=function(a){return a!==a},_.isBoolean=function(a){return a===!0||a===!1||g.call(a)=="[object Boolean]"},_.isDate=function(a){return g.call(a)=="[object Date]"},_.isRegExp=function(a){return g.call(a)=="[object RegExp]"},_.isNull=function(a){return a===null},_.isUndefined=function(a){return a===void 0},_.noConflict=function(){return root._=previousUnderscore,this},_.identity=function(a){return a},_.times=function(a,b,c){for(var d=0;d<a;d++)b.call(c,d)},_.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},_.mixin=function(a){u(_.functions(a),function(b){B(b,_[b]=a[b])})};var y=0;_.uniqueId=function(a){var b=y++;return a?a+b:b},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},_.template=function(a,b){var c=_.templateSettings,d="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+a.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(c.escape,function(a,b){return"',_.escape("+b.replace(/\\'/g,"'")+"),'"}).replace(c.interpolate,function(a,b){return"',"+b.replace(/\\'/g,"'")+",'"}).replace(c.evaluate||null,function(a,b){return"');"+b.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+";__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",e=new Function("obj","_",d);return b?e(b,_):function(a){return e(a,_)}};var z=function(a){this._wrapped=a};_.prototype=z.prototype;var A=function(a,b){return b?_(a).chain():a},B=function(a,b){z.prototype[a]=function(){var a=e.call(arguments);return f.call(a,this._wrapped),A(b.apply(_,a),this._chain)}};_.mixin(_),u(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var c=b[a];z.prototype[a]=function(){return c.apply(this._wrapped,arguments),A(this._wrapped,this._chain)}}),u(["concat","join","slice"],function(a){var c=b[a];z.prototype[a]=function(){return A(c.apply(this._wrapped,arguments),this._chain)}}),z.prototype.chain=function(){return this._chain=!0,this},z.prototype.value=function(){return this._wrapped}})();var BinaryHeap,ContInfo,EventStream,EventStream_api,HeapStore,InternalE,Jolt,OneE,OneE_high,PriorityQueue,Pulse,ReceiverE,ZeroE,beforeNextPulse,beforeQ,cleanupQ,cleanupWeakReference,clog_err,defer,defer_high,delay,doNotPropagate,exporter,internalE,isE,isNodeJS,isP,lastRank,lastStamp,linkHigh,linkTight,nextRank,nextStamp,oneE,oneE_high,receiverE,say,sayErr,sayError,scheduleBefore,scheduleCleanup,scheduleHigh,scheduleMid,scheduleNorm,sendCall,sendEvent,zeroE,_say,_say_helper,__slice=Array.prototype.slice,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};BinaryHeap=function(){function a(a){this.scoreFunction=a!=null?a:function(a){return a},this.content=[]}return a.prototype.push=function(a){return this.content.push(a),this._bubbleUp(this.content.length-1)},a.prototype.pop=function(){var a,b;return b=this.content[0],a=this.content.pop(),this.content.length>0&&(this.content[0]=a,this._sinkDown(0)),b},a.prototype.size=function(){return this.content.length},a.prototype.remove=function(a){var b,c,d;d=this.content.length;for(c=0;0<=d?c<d:c>d;0<=d?c++:c--)if(this.content[c]===a){b=this.content.pop(),c!==d-1&&(this.content[c]=b,this.scoreFunction(b)<this.scoreFunction(a)?this._bubbleUp(c):this._sinkDown(c));return}throw new Error("Node not found.")},a.prototype._bubbleUp=function(a){var b,c,d;b=this.content[a];while(a>0){d=Math.floor((a+1)/2)-1,c=this.content[d];if(this.scoreFunction(b)<this.scoreFunction(c))this.content[d]=b,this.content[a]=c,a=d;else break}},a.prototype._sinkDown=function(a){var b,c,d,e,f,g,h,i,j,k,l;k=this.content.length,j=this.content[a],i=this.scoreFunction(j);for(;;){f=(a+1)*2,c=f-1,l=null,c<k&&(b=this.content[c],d=this.scoreFunction(b),d<i&&(l=c)),f<k&&(e=this.content[f],g=this.scoreFunction(e),h=l===null?i:d,g<h&&(l=f));if(l!==null)this.content[a]=this.content[l],this.content[l]=j,a=l;else break}},a}(),isNodeJS=Boolean(typeof process!="undefined"&&process!==null?process.pid:void 0),Jolt={},_say=function(){var a,b,c;b=arguments[0],a=arguments[1],c=3<=arguments.length?__slice.call(arguments,2):[];if(_say.okay==null){if((typeof console=="undefined"||console===null)&&(typeof window!=="undefined"&&window!==null?window.console:void 0)==null)throw _say.okay=-1,clog_err;if(typeof console=="undefined"||console===null)console=typeof window!="undefined"&&window!==null?window.console:void 0;_say.console=console,_say.error=console.error!=null}if(console.log==null)throw _say.okay=-1,clog_err;_say.okay=1;if(_say.okay===-1)throw clog_err;if(!isNodeJS)return _say_helper(b,a);switch(c.length){case 0:b=b;break;case 1:b=_say.clc[c[0]](b);break;case 2:b=_say.clc[c[0]][c[1]](b);break;case 3:b=_say.clc[c[0]][c[1]][c[2]](b);break;default:b=_say.clc[c[0]][c[1]][c[2]][c[3]](b)}return _say_helper(b,a)},isNodeJS&&(_say.clc=require("cli-color")),clog_err="Jolt.say: console.log method is not available",_say_helper=function(a,b){if(b&&_say.error!=null){_say.console.error(a);return}return _say.console.log(a)},Jolt.say=say=function(){var a,b;return a=arguments[0],b=2<=arguments.length?__slice.call(arguments,1):[],_say.apply(null,[a,!1].concat(__slice.call(b)))},Jolt.sayError=Jolt.sayErr=sayError=sayErr=function(){var a,b;return a=arguments[0],b=2<=arguments.length?__slice.call(arguments,1):[],_say.apply(null,[a,!0].concat(__slice.call(b)))},Jolt.PriorityQueue=PriorityQueue=function(){function a(){this.content=[]}return __extends(a,BinaryHeap),a.prototype.scoreFunction=function(a){return a.rank},a}(),lastStamp=0,Jolt.nextStamp=nextStamp=function(){return++lastStamp},Jolt.doNotPropagate=doNotPropagate={},doNotPropagate.copy=function(){return this},Jolt.scheduleHigh=scheduleHigh={},Jolt.scheduleMid=scheduleMid={},Jolt.scheduleNorm=scheduleNorm={},Jolt.linkHigh=linkHigh={},Jolt.linkTight=linkTight={},Jolt.sendCall=sendCall={name:function(){return"Jolt.sendEvent"},removeWeakReference:function(){}},isNodeJS?(Jolt.defer_high=defer_high=function(){var a,b;return b=arguments[0],a=2<=arguments.length?__slice.call(arguments,1):[],process.nextTick(function(){return b.apply(null,a)})},Jolt.delay=delay=function(){var a,b,c;return b=arguments[0],c=arguments[1],a=3<=arguments.length?__slice.call(arguments,2):[],setTimeout(function(){return b.apply(null,a)},c)}):(Jolt.defer_high=defer_high=function(){var a,b;return b=arguments[0],a=2<=arguments.length?__slice.call(arguments,1):[],defer.apply(null,[b].concat(__slice.call(a)))},Jolt.delay=delay=function(){var a,b,c;return b=arguments[0],c=arguments[1],a=3<=arguments.length?__slice.call(arguments,2):[],window.setTimeout(function(){return b.apply(null,a)},c)}),Jolt.defer=defer=function(){var a,b;return b=arguments[0],a=2<=arguments.length?__slice.call(arguments,1):[],delay.apply(null,[b,0].concat(__slice.call(a)))},Jolt.cleanupQ=cleanupQ=cleanupWeakReference=[],cleanupQ.draining=!1,cleanupQ.freq=100,cleanupQ.drain=function(){return cleanupQ.length?(cleanupQ.shift()(),delay(cleanupQ.drain,cleanupQ.freq)):cleanupQ.draining=!1},Jolt.scheduleCleanup=scheduleCleanup=function(a,b,c){a||(a=cleanupWeakReference);if(!c.cleanupScheduled){c.cleanupScheduled=!0,a.push(function(){return b.removeWeakReference(c,!0)});if(!a.draining)return a.draining=!0,delay(a.drain,a.freq)}},Jolt.beforeQ=beforeQ=beforeNextPulse={high:[],mid:[],norm:[]},beforeQ.drainingHigh=!1,beforeQ.drainingMid=!1,beforeQ.drainingNorm=!1,beforeQ.freq=10,beforeQ.drainHigh=function(){return beforeQ.high.length?(defer_high(beforeQ.drainHigh),beforeQ.high.shift()()):beforeQ.drainingHigh=!1},beforeQ.drainMid=function(){return beforeQ.mid.length?(defer(beforeQ.drainMid),beforeQ.mid.pop()()):beforeQ.drainingMid=!1},beforeQ.drainNorm=function(){if(!beforeQ.norm.length)return beforeQ.drainingNorm=!1;delay(beforeQ.drainNorm,beforeQ.freq);if(!beforeQ.drainingHigh)return beforeQ.norm.shift()()},beforeQ.drainAll=function(){var a;if(beforeQ.high.length)while(beforeQ.high.length)beforeQ.high.shift()();if(beforeQ.mid.length)while(beforeQ.mid.length)beforeQ.mid.pop()();if(beforeQ.norm.length){a=[];while(beforeQ.norm.length)a.push(beforeQ.norm.shift()());return a}},Jolt.scheduleBefore=scheduleBefore=function(){var a,b,c,d;b=arguments[0],c=arguments[1],a=3<=arguments.length?__slice.call(arguments,2):[],b||(b=beforeNextPulse),d="norm",a[a.length-1]===scheduleHigh&&(d="high",a.pop()),a[a.length-1]===scheduleMid&&(d="mid",a.pop());switch(d){case"high":b.high.push(function(){return c.apply(null,a)});if(!b.drainingHigh)return b.drainingHigh=!0,defer_high(b.drainHigh);break;case"mid":b.mid.push(function(){return c.apply(null,a)});if(!b.drainingMid)return b.drainingMid=!0,defer(b.drainMid);break;case"norm":b.norm.push(function(){return c.apply(null,a)});if(!b.drainingNorm)return b.drainingNorm=!0,delay(b.drainNorm,b.freq)}},Jolt.HeapStore=HeapStore=function(){function a(a,b){this.stamp=a,this.cont=b,this.nodes=[]}return a}(),Jolt.ContInfo=ContInfo=function(){function a(a,b){this.stamps=a,this.nodes=b}return a}(),Jolt.isP=isP=function(a){return a instanceof Pulse},Jolt.Pulse=Pulse=function(){function a(a,b,c,d,e,f,g){this.arity=a,this.junction=b,this.sender=c,this.stamp=d,this.value=e!=null?e:[],this.heap=f!=null?f:new HeapStore(this.stamp,g)}return a.prototype.copy=function(a){return a==null&&(a=this.constructor),new a(this.arity,this.junction,this.sender,this.stamp,this.value.slice(0),this.heap)},a.prototype.propagate=function(){var a,b,c,d,e,f,g,h,i,j,k,l;h=arguments[0],g=arguments[1],b=arguments[2],c=4<=arguments.length?__slice.call(arguments,3):[];if(!g.weaklyHeld){e=new PriorityQueue,e.push({estream:g,pulse:this,rank:g.rank});while(e.size()){f=e.pop(),f.pulse.heap.nodes.push([f.pulse.sender,f.estream]),a=f.pulse.copy(f.estream.PulseClass()),d=a.PROPAGATE.apply(a,[a.sender,f.estream,b].concat(__slice.call(c))),i=!0;if(d!==doNotPropagate){d.sender=f.estream,l=f.estream.sendTo;for(j=0,k=l.length;j<k;j++)g=l[j],i=i&&g.weaklyHeld,g.weaklyHeld?f.estream.removeWeakReference(g):e.push({estream:g,pulse:d,rank:g.rank});f.estream.sendTo.length&&i&&(f.estream.weaklyHeld=!0,f.pulse.sender.removeWeakReference(f.estream))}}return a.heap}return h.removeWeakReference(g),this.heap},a.prototype.PROPAGATE=function(){var a,b,c,d,e;e=arguments[0],d=arguments[1],b=arguments[2],c=4<=arguments.length?__slice.call(arguments,3):[],a=d.UPDATER(this);if(a!==doNotPropagate&&!isP(a))throw"receiver's UPDATER did not return a pulse object";return a},a}(),lastRank=0,nextRank=function(){return++lastRank},Jolt.isE=isE=function(a){return a instanceof EventStream},Jolt.EventStream=EventStream=function(){function c(){var a,b,c,d,e;b=1<=arguments.length?__slice.call(arguments,0):[],this.rank=nextRank(),this.absRank=this.rank,this.sendTo=[],this.linkTo=[];if(b.length){e=_.flatten(__slice.call(b));for(c=0,d=e.length;c<d;c++)a=e[c],a.attachListener(this)}}var a,b;return b="expected an EventStream",c.prototype.attachListener=function(a,c){var d,e,f,g;c==null&&(c=!1);if(_.isArray(a))return a=_.flatten(a);a=[a],g=[];for(e=0,f=a.length;e<f;e++){d=a[e];if(!isE(d))throw"<"+this.ClassName+">.attachListener: "+b;c?this.constructor.genericAttachListener(this,d):scheduleBefore(beforeQ,function(a,b){return a.attachListener(b,!0)},this,d),g.push(this)}return g},c.prototype.removeListener=function(a,c){var d,e,f,g;c==null&&(c=!1);if(_.isArray(a))return a=_.flatten(a);a=[a],g=[];for(e=0,f=a.length;e<f;e++){d=a[e];if(!isE(d))throw"<"+this.ClassName+">.removeListener: "+b;c?this.constructor.genericRemoveListener(this,d):scheduleBefore(beforeQ,function(a,b){return a.removeListener(b,!0)},this,d),g.push(this)}return g},c.prototype.removeWeakReference=function(a,c){c==null&&(c=!1);if(!isE(a))throw"<"+this.ClassName+">.removeWeakReference: "+b;return c?this.constructor.genericRemoveWeakReference(this,a):scheduleCleanup(cleanupQ,this,a),this},c.prototype.ClassName="EventStream",c.prototype.cleanupScheduled=!1,a=".genericAttachListener: cycle detected in propagation graph",c.genericAttachListener=function(b,c){var d,e,f,g,h,i,j,k;if(b.rank===c.rank)throw b.ClassName+a;g=_.indexOf(b.sendTo,c);if(!(g+1)){c.weaklyHeld=!1,b.sendTo.push(c);if(b.rank>c.rank){e=[],i={},b.__cycleSentinel__=i,h=[c];while(h.length){d=h.shift();if(d.__cycleSentinel__===i)throw b.sendTo.pop(),b.ClassName+a;e.push(d),d.__cycleSentinel__=i,h.push.apply(h,d.sendTo)}for(j=0,k=e.length;j<k;j++)f=e[j],f.rank=nextRank()}}return},c.genericRemoveListener=function(a,b){var c;c=_.indexOf(a.sendTo,b),c+1&&a.sendTo.splice(c,1);return},c.genericRemoveWeakReference=function(a,b){var c;b.cleanupScheduled=!1,b.weaklyHeld&&(c=_.indexOf(a.sendTo,b),c+1&&a.sendTo.splice(c,1),a.sendTo.length||(a.weaklyHeld=!0));return},c.prototype._mode=null,c.prototype.mode=function(a){if(!arguments.length)return this._mode;if(a==null)return this._mode=null,this;switch(a){case"sequenced":case"s":this._mode="sequenced";break;case"vectored":case"v":this._mode="vectored";break;case"zipped":case"z":this._mode="zipped";break;default:throw"<"+this.ClassName+">.mode: "+JSON.stringify(a)+" is not a valid mode"}return this},c.prototype["null"]=function(){return this.mode(null)},c.prototype.s=function(){return this.mode("sequenced")},c.prototype.sequenced=function(){return this.s()},c.prototype.v=function(){return this.mode("vectored")},c.prototype.vectored=function(){return this.v()},c.prototype.z=function(){return this.mode("zipped")},c.prototype.zipped=function(){return this.z()},c.prototype._name=null,c.prototype.name=function(a){if(!arguments.length)return this._name;if(!_.isString(a))throw"<"+this.ClassName+">.name: argument must be a string";return this._name=a,this},c.prototype._nary=!1,c.prototype.nary=function(){return this._nary=!0,this},c.prototype.isNary=function(a){return arguments.length?(this._nary=Boolean(a),this):this._nary},c.prototype._recur=!1,c.prototype.recur=function(){return this._recur=!0,this},c.prototype.doesRecur=function(a){return arguments.length?(this._recur=Boolean(a),this):this._recur},c.prototype.no_null_junc=!1,c.prototype._PulseClass=Pulse,c.prototype.PulseClass=function(a){if(!arguments.length)return this._PulseClass;if(!_.isFunction(a))throw"<"+this.ClassName+">.PulseClass: argument must be a function";if(!isP(new a))throw"<"+this.ClassName+">.PulseClass: argument does not construct an instanceof Pulse";return this._PulseClass=a,this},c.prototype.seq_junc_helper=function(a){var b,c,d,e;c=[];for(d=0,e=a.length;d<e;d++)b=a[d],b.junction?c=c.concat(this.seq_junc_helper(b.value)):c=c.concat(b.value);return c},c.prototype.vec_junc_helper=function(a){var b,c,d,e;c=[];for(d=0,e=a.length;d<e;d++)b=a[d],b.junction?c=c.concat(this.vec_junc_helper(b.value)):c.push(b.value);return c},c.prototype.zip_junc_helper=function(a){return _.zip.apply(_,this.vec_junc_helper(a))},c.prototype.tranIN=function(a){var b;b=a.copy();switch(this.mode()){case"sequenced":if(b.junction)b.value=this.seq_junc_helper(b.value);else return b;break;case"vectored":if(b.junction)b.value=this.vec_junc_helper(b.value);else return b.value=[b.value],b.arity=1,b;break;case"zipped":if(b.junction)b.value=this.zip_junc_helper(b.value);else return b.value=_.zip(b.value),b;break;case null:if(b.junction&&this.no_null_junc)throw"<"+this.ClassName+">.tranIN: does not support null mode for pulse junctions";return b;default:throw"<"+this.ClassName+">.tranIN: bad mode value "+JSON.stringify(this.mode())}return b.arity=b.value.length,b.junction=!1,b},c.prototype.tranOUT=function(a){var b,c;return b=a.copy(),b!==doNotPropagate&&this.isNary()&&(b.value=(c=[]).concat.apply(c,b.value)),b},c.prototype.tranVAL=function(a){var b,c,d,e,f,g,h,i,j,k,l;b=a.copy();switch(this.mode()){case null:case"sequenced":f=this.updater.apply(this,b.value),f===doNotPropagate?b=f:b.value=f;break;case"vectored":case"zipped":f=[],j=b.value;for(h=0,i=j.length;h<i;h++)g=j[h],c=this.updater.apply(this,g),c!==doNotPropagate&&f.push(c);f.length===0?b=doNotPropagate:this.doesRecur()?(e=(k=[]).concat.apply(k,f),this.isNary()&&(e=(l=[]).concat.apply(l,e)),d=this.updater.apply(this,e),d===doNotPropagate?b=d:b.value=d):b.value=f;break;default:throw"<"+this.ClassName+">.UPDATER: bad mode value "+JSON.stringify(this.mode())}return b},c.prototype.updater=function(){var a;return a=1<=arguments.length?__slice.call(arguments,0):[],a},c.prototype.UPDATER=function(a){return this.tranOUT(this.tranVAL(this.tranIN(a)))},c.prototype.weaklyHeld=!1,c}(),Jolt.sendEvent=sendEvent=function(){var a,b,c,d,e,f,g,h,i;d=arguments[0],i=2<=arguments.length?__slice.call(arguments,1):[],b=void 0,c=i[i.length-1],c instanceof ContInfo&&(b=c,i.pop()),f=!1,b?g=i[i.length-1]:g=c,g===propagateHigh&&(f=!0,i.pop()),e=void 0,a=d.PulseClass(),h=new a(i.length,!1,sendCall,nextStamp(),i,e,b),h.propagate(sendCall,d,f);return},Jolt.EventStream_api=EventStream_api=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,EventStream),a.factory=function(){var a;return a=1<=arguments.length?__slice.call(arguments,0):[],function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return typeof e=="object"?e:d}(this,a,function(){})},a}(),Jolt.InternalE=InternalE=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,EventStream_api),a.prototype.ClassName="InternalE",a}(),Jolt.internalE=internalE=function(){var a;return a=1<=arguments.length?__slice.call(arguments,0):[],InternalE.factory.apply(InternalE,a)},EventStream_api.prototype.internalE=function(){var a;return a=1<=arguments.length?__slice.call(arguments,0):[],internalE.apply(null,__slice.call(a).concat([this]))},Jolt.ReceiverE=ReceiverE=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,EventStream_api),a.prototype.ClassName="ReceiverE",a.factory=function(){return new this},a.prototype.sendEvent=function(){var a;return a=1<=arguments.length?__slice.call(arguments,0):[],sendEvent.apply(null,[this].concat(__slice.call(a)))},a}(),Jolt.receiverE=receiverE=function(){return ReceiverE.factory()},Jolt.ZeroE=ZeroE=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,EventStream_api),a.prototype.ClassName="ZeroE",a.prototype.UPDATER=function(a){throw"<"+this.ClassName+">.UPDATER: received a pulse; an instance of "+this.ClassName+" should never receive a pulse"},a}(),Jolt.zeroE=zeroE=function(){var a;return a=1<=arguments.length?__slice.call(arguments,0):[],ZeroE.factory.apply(ZeroE,a)},EventStream_api.prototype.zeroE=function(){var a;return a=1<=arguments.length?__slice.call(arguments,0):[],zeroE.apply(null,(a.push(this),a))},Jolt.OneE=OneE=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,EventStream_api),a.prototype.ClassName="OneE",a.factory=function(){var a,b;return b=1<=arguments.length?__slice.call(arguments,0):[],a=new this,scheduleBefore.apply(null,[beforeQ,sendEvent,a].concat(__slice.call(b),[scheduleMid])),a},a.prototype.sent=!1,a.prototype.UPDATER=function(b){if(this.sent)throw"<"+this.ClassName+">.UPDATER: received an extra pulse; an instance of "+this.ClassName+" should never receive more than 1 pulse";return this.sent=!0,a.__super__.UPDATER.apply(this,arguments)},a}(),Jolt.oneE=oneE=function(){var a;return a=1<=arguments.length?__slice.call(arguments,0):[],OneE.factory.apply(OneE,a)},Jolt.OneE_high=OneE_high=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,OneE),a.prototype.attachListener=function(b){var c;return c=b.attachListener,b.attachListener=function(a){return c.call(b,a,!0)},a.__super__.attachListener.call(this,b,!0)},a.prototype.removeListener=function(b){var c;return c=b.removeListener,b.removeListener=function(a){return c.call(b,a,!0)},a.__super__.removeListener.call(this,b,!0)},a.prototype.ClassName="OneE_high",a.factory=function(){var a,b;return b=1<=arguments.length?__slice.call(arguments,0):[],a=new this,scheduleBefore.apply(null,[beforeQ,sendEvent,a].concat(__slice.call(b),[propagateHigh],[scheduleHigh])),a},a}(),Jolt.oneE_high=oneE_high=function(){var a;return a=1<=arguments.length?__slice.call(arguments,0):[],OneE_high.factory.apply(OneE_high,a)},exporter=function(a,b){var c,d,e;a==null&&(a=Jolt),b==null&&(b=exports),e=[];for(c in a){if(!__hasProp.call(a,c))continue;d=a[c],e.push(b[c]=a[c])}return e},Jolt.EventEmitter2=EventEmitter,Jolt._=_,Jolt.globalize=function(){var a,b,c,d,e;a=1<=arguments.length?__slice.call(arguments,0):[],c=typeof window!="undefined"&&window!==null?window:typeof global!="undefined"&&global!==null?global:{},a.length||exporter(Jolt,c);for(d=0,e=a.length;d<e;d++)b=a[d],exporter(b,c)},exporter()
}).call(this, ((typeof exports !== 'undefined') ? exports : (this.previousJolt = this.Jolt, this.Jolt = {}, this.Jolt)))
